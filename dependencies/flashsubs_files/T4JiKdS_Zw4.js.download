if (self.CavalryLogger) { CavalryLogger.start_js(["txlNg"]); }

__d('MercurySyncClientPayloadTransformer',['DateConsts','LiveLocationStopReason','MercuryActionType','MessageLiveLocationClientSyncProtocolStopReason','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')(c('LiveLocationStopReason')),i=8;function j(n){var o=n.payload;o=JSON.parse(String.fromCharCode.apply(null,o));var p=o&&o.deltas,q=p[0];if(q.deltaMessageReaction){return k(q.deltaMessageReaction);}else if(q.liveLocationData){return l(q.liveLocationData);}else return m(q);}function k(n){var o=n.messageId,p=n.offlineThreadingId,q=n.reaction,r=n.senderId,s=n.userId,t=n.threadKey.threadFbId||n.threadKey.otherUserFbId;return {action_type:c('MercuryActionType').REACTION_UPDATE,messageId:o,offlineThreadingId:p,reaction:q?decodeURIComponent(window.escape(q)):undefined,senderId:r,thread_fbid:t.toString(),userId:s};}function l(n){var o=n.threadKey;if(!o)return null;var p=o.threadFbId||o.otherUserFbId;if(!p)return null;if(!n.messageLiveLocations||n.messageLiveLocations.length!==1)return null;var q=n.messageLiveLocations[0],r=q.expirationTime,s=q.stopReason!=null||Date.now()/c('DateConsts').MS_PER_SEC>r,t=function x(y){return y/Math.pow(10,i);},u=q.coordinate?{latitude:t(q.coordinate.latitude),longitude:t(q.coordinate.longitude)}:null,v=null;if(q.destination)v={latitude:t(q.destination.latitude),longitude:t(q.destination.longitude),label:q.destination.label};var w=null;switch(q.stopReason){case c('MessageLiveLocationClientSyncProtocolStopReason').EXPIRED:w=h.EXPIRED;break;case c('MessageLiveLocationClientSyncProtocolStopReason').CANCELED:w=h.CANCELED;break;case c('MessageLiveLocationClientSyncProtocolStopReason').ARRIVED:w=h.ARRIVED;break;}return {action_type:c('MercuryActionType').LIVE_LOCATION_UPDATE,thread_fbid:p.toString(),messageId:q.messageId,liveLocation:{live_location_id:q.id.toString(),is_expired:s,expiration_time:r,sender:{id:q.senderId.toString()},coordinate:u,location_title:q.locationTitle,sender_destination:v,stop_reason:w}};}function m(n){var o=n&&n.deltaPaymentPinProtectionStatusData,p=o&&o.threadKey&&o.threadKey.otherUserFbId,q=o&&o.isPinProtected;if(!p)return null;var r=p.toString();return {action_type:c('MercuryActionType').IS_PIN_PROTECTED,thread_fbid:r,is_pin_protected:q};}f.exports={transform:j};}),null);