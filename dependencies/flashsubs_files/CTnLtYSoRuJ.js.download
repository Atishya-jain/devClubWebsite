if (self.CavalryLogger) { CavalryLogger.start_js(["F8lNw"]); }

__d('MessageList.react',['cx','immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageGroup','MessagingGenericAdminTextType','MessengerAdminGroupUtils','messengerDomIDsRe','MessengerLightweightActionUtils','PagesMessageListGreeting.react','React','ReactDOM','MercuryShareAttachmentRenderLocations','idx'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('messengerDomIDsRe').ids,l=c('React').PropTypes,m=1000*60*60,n=function v(w){var x,y,z,aa=(x=w)!=null?(x=x.log_message_data)!=null?x.message_type:x:x;switch(aa){case c('MessagingGenericAdminTextType').GROUP_POLL:return (y=w)!=null?(y=y.log_message_data)!=null?(y=y.untypedData)!=null?y.question_id:y:y:y;case c('MessagingGenericAdminTextType').INSTANT_GAME_UPDATE:return (z=w)!=null?(z=z.log_message_data)!=null?(z=z.untypedData)!=null?z.game_id:z:z:z;default:return null;}},o=function v(w){if(c('MessengerLightweightActionUtils').isLWAMessage(w))return 'lwa';return null;};i=babelHelpers.inherits(p,c('React').PureComponent);j=i&&i.prototype;function p(){var v,w;for(var x=arguments.length,y=Array(x),z=0;z<x;z++)y[z]=arguments[z];return w=(v=j.constructor).call.apply(v,[this].concat(y)),this.state={activeMessageID:null,messageGroups:c('MercuryMessageGroup').calculateMessageGroups(this.props.messages,this.props.location)},this.$MessageList4=function(aa){this.setState(function(ba){return {activeMessageID:ba.activeMessageID===aa?null:ba.activeMessageID};});}.bind(this),this.$MessageList5=function(aa){this.setState({activeMessageID:aa});}.bind(this),w;}p.prototype.componentWillReceiveProps=function(v){if(v.messages!==this.props.messages)this.setState({messageGroups:c('MercuryMessageGroup').calculateMessageGroups(v.messages,v.location)});};p.prototype.render=function(){var v=this.props,w=v.DateBreak,x=v.location,y=v.MessageGroup,z=v.CollapsedLogMessageGroup,aa=[],ba=[],ca=void 0,da=this.props.thread&&this.props.thread.custom_color,ea=da?{backgroundColor:da}:null,fa=this.state.activeMessageID,ga=this.state.messageGroups,ha=ga.length,ia=this.props.readReceipts,ja=ia.last(),ka=ja?ja.watermark:0,la=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer),ma=c('MessengerAdminGroupUtils').isJoinableThread(this.props.thread),na={};for(var oa=this.props.messages.size-1;oa>=0;oa--){var pa=this.props.messages.get(oa),qa=n(pa)||o(pa);if(qa&&!na[qa])na[qa]=pa.message_id;}for(var ra=0;ra<ha;ra++){var sa=ra>0?ga[ra-1]:null,ta=sa&&sa.length>0?sa[sa.length-1]:null,ua=ga[ra],va=ua[0],wa=ua[ua.length-1],xa=false;if(!ta||va.timestamp-ta.timestamp>m){xa=true;var ya=c('React').createElement(w,{date:new Date(va.timestamp),key:'db:'+va.message_id,ref:'db:'+va.message_id});if(ba.length===0)aa.push(ya);}if(c('MessengerLightweightActionUtils').isLWAMessage(va))if(na[o(va)]!==va.message_id){var za=this.$MessageList1(va,na);aa.push(za);continue;}if(va.action_type==c('MercuryActionType').LOG_MESSAGE){var ab,bb=(ab=va)!=null?(ab=ab.log_message_data)!=null?ab.message_type:ab:ab,cb=bb===c('MessagingGenericAdminTextType').INSTANT_GAME_UPDATE,db=bb===c('MessagingGenericAdminTextType').GROUP_POLL;if((x===c('MercuryShareAttachmentRenderLocations').CHAT||x===c('MercuryShareAttachmentRenderLocations').MESSENGER)&&(va.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||va.log_message_type===c('MercuryLogMessageType').PHONE_CALL)){var eb=this.$MessageList2(va,la,ga,ha,ra,ia,ka,wa);aa.push(eb);}else{var fb=this.$MessageList3(va,na);ca=va.message_id;if(ma&&!cb&&!db){ba.push(fb);}else{if(ba.length!==0){if(ba.length>1){aa.push(c('React').createElement(z,{key:'mg:'+ca,style:ea},ba));}else aa.push(c('React').createElement('div',{key:'mg:'+ca},ba));ba=[];}aa.push(fb);}}continue;}if(ba.length!==0){if(ba.length>1){aa.push(c('React').createElement(z,{key:'mg:'+ca,style:ea},ba));}else aa.push(c('React').createElement('div',{key:'mg:'+ca},ba));ba=[];}ua=c('immutable').List(ua);var gb=r(ga,ha,ra),hb=!t(ia,ua,gb),ib=s(ka,wa),jb=u(this.props.deliveryTimestamp,wa);aa.push(c('React').createElement(y,{activeMessageID:q(fa,ua),author:ua.first().author,deliveryTimestamp:jb,hasDateBreak:xa,isCanonical:this.props.isCanonical,isFromViewer:la===va.author,isPageMessage:this.props.isPageMessage,key:'mg:'+va.message_id,lastReadTimestamp:ib,maxBubbleWidth:this.props.maxBubbleWidth,messages:ua,nextTimestamp:gb,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$MessageList4,onMessageSelect:this.$MessageList5,onStickerClick:this.props.onStickerClick,pageID:this.props.isPageMessage?this.props.viewer:null,readReceipts:hb?ia:c('immutable').OrderedMap(),ref:'mg:'+va.message_id,thread:this.props.thread,threadID:this.props.threadID}));}if(ba.length!==0){if(ba.length>1){aa.push(c('React').createElement(z,{key:'mg:'+ca,style:ea},ba));}else aa.push(c('React').createElement('div',{key:'mg:'+ca},ba));ba=[];}var kb=this.props.threadID||this.props.thread&&this.props.thread.thread_id||this.props.thread&&this.props.thread.thread_fbid,lb=null;if(x===c('MercuryShareAttachmentRenderLocations').MESSENGER&&kb&&this.props.isPageMessage)lb=c('React').createElement(c('PagesMessageListGreeting.react'),{messageCount:ba.length+ha,threadID:kb});return c('React').createElement('div',{id:x===c('MercuryShareAttachmentRenderLocations').MESSENGER?k.CONVERSATION:null},lb,aa);};p.prototype.getMessageElement=function(v,w){if(w){var x=this.refs['db:'+v];if(x)return c('ReactDOM').findDOMNode(x);}var y=this.state.messageGroups.find(function(ba){return ba.some(function(ca){return ca.message_id===v;});});if(!y)return null;var z=y[0].message_id,aa=this.refs['mg:'+z];if(!aa)return null;if(w&&z===v)return c('ReactDOM').findDOMNode(aa);return aa.getMessageElement(v);};p.prototype.$MessageList2=function(v,w,x,y,z,aa,ba,ca){var da=this.props.MessageGroup,ea={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:v.log_message_body,log_message_data:v.log_message_data,log_message_type:v.log_message_type,timestamp:v.timestamp}},fa=c('ImmutableObject').setProperty(v,'attachments',[ea]);fa=c('ImmutableObject').setProperty(fa,'body','');var ga=c('immutable').List([fa]),ha=r(x,y,z),ia=!t(aa,ga,ha),ja=s(ba,ca),ka=u(this.props.deliveryTimestamp,ca);return c('React').createElement(da,{author:ga.first().author,deliveryTimestamp:ka,isFromViewer:w===v.author,key:v.message_id,lastReadTimestamp:ja,maxBubbleWidth:this.props.maxBubbleWidth,messages:ga,nextTimestamp:ha,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$MessageList4,onMessageSelect:this.$MessageList5,onStickerClick:this.props.onStickerClick,readReceipts:ia?aa:c('immutable').OrderedMap(),thread:this.props.thread,threadID:this.props.threadID});};p.prototype.$MessageList3=function(v,w){var x=this.props.LogMessage,y=w[n(v)];if(v.log_message_type!==c('MercuryLogMessageType').SERVER_ERROR)return c('React').createElement(x,{className:this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT?"_5w0o":null,key:v.message_id,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:v,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread,isLastOfType:y===v.message_id});return null;};p.prototype.$MessageList1=function(v,w){var x=w[o(v)],y=this.props.LogMessage;return c('React').createElement(y,{className:this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT?"_5w0o":null,key:v.message_id,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:v,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread,isLastOfType:x===v.message_id});};p.propTypes={CollapsedLogMessageGroup:l.func.isRequired,DateBreak:l.func.isRequired,deliveryTimestamp:l.number.isRequired,isCanonical:l.bool,isPageMessage:l.bool,location:l.string.isRequired,LogMessage:l.func.isRequired,loadMoreMessages:l.func,MessageGroup:l.func.isRequired,messages:l.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:l.func,onStickerClick:l.func,readReceipts:l.instanceOf(c('immutable').OrderedMap).isRequired,viewer:l.string.isRequired,thread:l.object,threadID:l.string};function q(v,w){return w.find(function(x){return x.message_id===v;})?v:null;}function r(v,w,x){return x<w-1?v[x+1][0].timestamp:Infinity;}function s(v,w){return w.timestamp>v?v:Infinity;}function t(v,w,x){return w.isEmpty()||v.last()<w.first().timestamp||v.first()>=x;}function u(v,w){return w.timestamp>v?v:Infinity;}f.exports=p;}),null);