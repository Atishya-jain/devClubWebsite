if (self.CavalryLogger) { CavalryLogger.start_js(["8C+gO"]); }

__d('MessengerMessage.react',['cssVar','cx','fbt','EmojiLikeUtils','MercuryDisplayTimeFilterMessageRenderer','FluxContainer','immutable','ImmutableObject','MercuryAttachment','MercuryConfig','MercuryMessageDeliveryState','MercuryMessageError.react','MercuryMessageInfo','MercuryTimestamp','MessengerAttachmentAttribution.react','MessengerAttachmentRenderer','MessengerBubble.react','MessengerBubbleBlock.react','MessengerCodeBubble.react','MessengerCodePasteUtils','MessengerConfig','MessengerDecorator','MessengerInnerDecorators.react','MessengerMessageActionsWrapper.react','messengerMessageSeenHeadsReact','messengerURIUtilsRe','MessengerVideoAutoplayStore','MNCommerceMessageType','React','TooltipData','emptyFunction','getViewportDimensions','joinClasses','messengerRTLClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('messengerMessageSeenHeadsReact').jsComponent,n=c('React').PropTypes;function o(r){switch(r){case c('MercuryMessageDeliveryState').SENDING:return j._("Sending");case c('MercuryMessageDeliveryState').SENT:return j._("Sent");case c('MercuryMessageDeliveryState').DELIVERED:return j._("Delivered");case c('MercuryMessageDeliveryState').ERROR:return j._("Error");}return null;}k=babelHelpers.inherits(p,c('React').Component);l=k&&k.prototype;function p(){var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=l.constructor).call.apply(r,[this].concat(u)),this.state={isVisible:false,shown:{}},this.$MessengerMessage12=function(w){w.stopPropagation();this.props.onSelect(this.props.message.message_id);}.bind(this),this.$MessengerMessage4=function(w,x){var y;this.setState({shown:babelHelpers['extends']({},this.state.shown,(y={},y[w]=x,y))});}.bind(this),this.$MessengerMessage10=function(){this.props.onSelect(this.props.message.message_id);}.bind(this),s;}p.getStores=function(){return [c('MessengerVideoAutoplayStore')];};p.calculateState=function(r,s){return {isVisible:c('MessengerVideoAutoplayStore').isVisible(s.message.thread_id,s.message.message_id)};};p.prototype.shouldComponentUpdate=function(r,s){return r.isActive!==this.props.isActive||r.isFromViewer!==this.props.isFromViewer||r.message!==this.props.message||r.nextTimestamp!==this.props.nextTimestamp||r.showDeliveryState!==this.props.showDeliveryState||r.deliveryTimestamp!==this.props.deliveryTimestamp||!c('immutable').is(r.readReceipts,this.props.readReceipts)||!c('immutable').is(r.participants,this.props.participants)||r.customColor!==this.props.customColor||s.isVisible!==this.state.isVisible;};p.prototype.render=function(){var r=this.props,s=r.isActive,t=r.isFromViewer,u=r.isPageMessage,v=r.message,w=j._("{time}",[j.param('time',c('MercuryTimestamp').getPreciseTimestamp(v.timestamp))]),x=c('TooltipData').propsFor(w,q(t)),y=[],z=[],aa=this.props.message,ba=t||false;if(aa&&!this.props.hideBeforeDecorator){c('MessengerDecorator').getBeforeDecorators().forEach(function(fa){if(fa.check(aa))y.push(fa.render(aa,ba));});c('MessengerDecorator').getInnerDecorators().forEach(function(fa){if(fa.check(aa))z.push(fa.getAdditionalClassNames());});}var ca=this.$MessengerMessage1(x,false),da=this.$MessengerMessage2(x,null);if(da)ca=this.$MessengerMessage1(x,true);var ea=!!da&&this.$MessengerMessage3();return c('React').createElement(c('MessengerMessageActionsWrapper.react'),{className:c('joinClasses').apply(undefined,["clearfix"+(' '+"_o46")+(' '+"_3erg")+(s?' '+"_-5k":'')+(t?' '+"_3i_m":'')+(t?' '+"_nd_":'')+(!t?' '+"_29_7":'')+(v.isSelected?' '+"_3xsz":'')+(ea?' '+"_q4a":''),c('messengerRTLClasses')(v.body)].concat(z)),message:v,onShowMenu:this.$MessengerMessage4},y,ca,da||u?null:c('React').createElement(c('MessengerInnerDecorators.react'),{message:aa,isFromViewer:t,hovered:this.state.shown[aa.message_id],messageProps:this.props}),da,this.$MessengerMessage5(aa,ba),this.$MessengerMessage6(),this.$MessengerMessage7(),c('React').createElement(m,{className:"_4jzq",isFromViewer:t,message:v,nextTimestamp:this.props.nextTimestamp,participants:this.props.participants,readReceipts:this.props.readReceipts}));};p.prototype.$MessengerMessage5=function(r,s){var t,u=this;if(r&&!this.props.hideAfterExternalDecorator){var t=function(){var v=[],w=[];c('MessengerDecorator').getAfterExternalDecorators().forEach(function(y){if(r&&y.check(r)){v.push(y.render(r,s,this.props));w.push(y.getAdditionalClassNames());}},u);var x=w.join(' ');if(v.length===0)return {v:null};return {v:c('React').createElement('span',{className:c('joinClasses')(x,"_31gm"+(!s?' '+"isFromOther":''))},v)};}();if(typeof t==="object")return t.v;}return null;};p.prototype.$MessengerMessage8=function(r){return r.every(function(s){return !s||!c('MessengerAttachmentRenderer').isRenderedShareAttachment(s);});};p.prototype.$MessengerMessage9=function(){return this.props.message.attachments.length===1&&c('MercuryAttachment').hasAttribution(this.props.message.attachments[0]);};p.prototype.$MessengerMessage2=function(r,s){if(this.props.message.is_filtered_content)return null;if(this.props.message.commerce_message_type===c('MNCommerceMessageType').RIDE_INTENT)return null;var t=[],u=[],v=this.props.message,w=this.props.isFromViewer||false;if(v)c('MessengerDecorator').getAfterDecorators().forEach(function(ba){if(ba.check(v,w)){t.push(ba.render(v,w,this.props));u.push(ba.getAdditionalClassNames());}}.bind(this));var x=c('MessengerAttachmentRenderer').getAttachmentsOutsideBubble(this.props.message,this.props.onAttachmentLoad,{customColor:this.props.customColor,isPageMessage:this.props.isPageMessage,isVisible:this.state.isVisible,messageBubble:s,onSelect:this.$MessengerMessage10,onUnwrap:null,pageID:this.props.pageID},t);if(!x||!x.length)return null;if(r){var y=x.some(function(ba){return !!ba&&c('MessengerAttachmentRenderer').isPhotosGroupAttachment(ba);});if(this.$MessengerMessage9())x=[c('React').createElement('span',{key:'AttachmentWithAttribution'},x[0],c('React').createElement(c('MessengerAttachmentAttribution.react'),{attachment:new (c('ImmutableObject'))(this.props.message.attachments[0])}))];x=this.$MessengerMessage8(x)?c('React').createElement('div',babelHelpers['extends']({},r,{className:c('joinClasses').apply(undefined,["_3zvs"+(y?' '+"_2-x3":'')].concat(u))}),x,t):x.map(function(ba){return ba&&c('React').cloneElement(ba,r);});}var z=c('MessengerAttachmentRenderer').isSharedVideoAttachmentMessage(this.props.message),aa=c('React').createElement('div',{key:'renderedAttachments',className:"_3058"+(' '+"_15gf")+(z?' '+"_3duc":'')},x,this.props.isPageMessage?null:c('React').createElement(c('MessengerInnerDecorators.react'),{message:this.props.message,isFromViewer:this.props.isFromViewer||false,hovered:this.state.shown[this.props.message.message_id],messageProps:this.props}));if(this.$MessengerMessage9())return c('React').createElement(c('MessengerBubbleBlock.react'),null,aa);return aa;};p.prototype.$MessengerMessage11=function(){return c('MessengerAttachmentRenderer').isP2PAttachment(this.props.message);};p.prototype.$MessengerMessage1=function(r,s){var t=this.props.message,u=c('immutable').List(c('MessengerAttachmentRenderer').getAttachmentsInsideBubble(t,this.props.onAttachmentLoad)),v=t.ranges;if(t.profile_ranges&&t.profile_ranges.length)v=(v||[]).concat(t.profile_ranges.map(function(x){return babelHelpers['extends']({},x,{url:c('messengerURIUtilsRe').getURIForUserID(x.id)});}));if(c('MessengerCodePasteUtils').containsCodeBlock(t.body))return c('React').createElement(c('MessengerCodeBubble.react'),{attachments:u,body:t.body,customColor:this.props.isFromViewer?this.props.customColor:'',className:(this.props.isFromViewer?"_3uhm":'')+(!this.props.isFromViewer?' '+"_3uhn":''),isFromViewer:this.props.isFromViewer,ranges:v||[],threadID:t.thread_id||''});if(t.is_filtered_content)return c('React').createElement('div',{className:"_3058 _wiu _52mr uiBoxYellow clearfix"},c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(t));var w=t.body&&!c('EmojiLikeUtils').isEmojiLike(t);if(w||!u.isEmpty())return c('React').createElement(c('MessengerBubble.react'),babelHelpers['extends']({attachments:u,body:t.body,className:"_3058"+(' '+"_ui9"),customColor:this.props.isFromViewer?this.props.customColor:'',customLike:t.customLike,excludeAfterDecorators:s,isFromViewer:this.props.isFromViewer,isP2PAttachment:this.$MessengerMessage11(),ranges:v,message:t,metaRanges:t.meta_ranges,threadCustomColor:this.props.threadCustomColor||"#0084ff",threadID:t.thread_id,participants:this.props.participants},r||{}));return null;};p.prototype.$MessengerMessage7=function(){if(!this.props.isFromViewer||!this.props.showDeliveryState||this.props.message.is_like_preview)return null;var r=c('MercuryMessageInfo').getDeliveryState(this.props.message,this.props.deliveryTimestamp);if(r===c('MercuryMessageDeliveryState').UNKNOWN)return null;var s={};if(this.props.customColor&&(r===c('MercuryMessageDeliveryState').SENT||r===c('MercuryMessageDeliveryState').SENDING||r===c('MercuryMessageDeliveryState').DELIVERED))s.color=this.props.customColor;return c('React').createElement('span',{className:"_2her"+(r===c('MercuryMessageDeliveryState').SENDING?' '+"_4jzp":'')+(r===c('MercuryMessageDeliveryState').SENT?' '+"_3zzf":'')+(r===c('MercuryMessageDeliveryState').DELIVERED?' '+"_9ah":'')+(r===c('MercuryMessageDeliveryState').ERROR?' '+"_5ei9":''),onClick:this.$MessengerMessage12,role:'checkbox',style:s,tabIndex:'0',title:o(r)},c('React').createElement('i',{className:"_57e_"}));};p.prototype.$MessengerMessage6=function(){var r=this.props.message;if(!c('MercuryMessageInfo').hasError(r))return null;return c('React').createElement(c('MercuryMessageError.react'),{className:"_3058 _2ygi",message:r,authorFBID:this.props.authorFBID});};p.prototype.$MessengerMessage3=function(){var r=this.props.message,s=false;if(r)s=!!(r.reactions&&Object.keys(r.reactions).length>0);return s;};p.propTypes={customColor:n.string,deliveryTimestamp:n.number.isRequired,hideAfterExternalDecorator:n.bool,hideBeforeDecorator:n.bool,isActive:n.bool,isFromViewer:n.bool,isPageMessage:n.bool,message:n.instanceOf(c('ImmutableObject')).isRequired,nextTimestamp:n.number.isRequired,onAttachmentLoad:n.func.isRequired,onDeselect:n.func.isRequired,onSelect:n.func.isRequired,participants:n.instanceOf(c('immutable').Map).isRequired,readReceipts:n.instanceOf(c('immutable').OrderedMap).isRequired,showDeliveryState:n.bool,authorFBID:n.string,threadCustomColor:n.string,pageID:n.string};p.defaultProps={onAttachmentLoad:c('emptyFunction'),threadCustomColor:"#0084ff"};function q(r){if(c('getViewportDimensions')().width<=parseInt("700px".replace('px',''),10))return 'above';return r?'right':'left';}f.exports=c('FluxContainer').create(p,{withProps:true});}),null);