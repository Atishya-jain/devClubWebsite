if (self.CavalryLogger) { CavalryLogger.start_js(["eJV0h"]); }

__d('MercuryThreadlistContainer.react',['Bootloader','immutable','MercuryAPIArgsSource','MercuryConfig','MercuryFilters','MercuryThreadlistConstants','MessagingTag','P2PJewelBannerContainer.react','React','SubscriptionsHandler'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=2,k=3600*.3*1000,l=c('React').PropTypes,m='search';h=babelHelpers.inherits(n,c('React').Component);i=h&&h.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=i.constructor).call.apply(o,[this].concat(r)),this.state={isLoading:true,isSearching:false,unreadMessageRequestThreads:[],threads:c('immutable').Map()},this.threadListReqsInFlight=0,this.$MercuryThreadlistContainer17=function(){this.$MercuryThreadlistContainer1.getFilteredThreadlist(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,c('MercuryThreadlistConstants').MAX_UNREAD_COUNT,c('MessagingTag').PENDING,c('MercuryFilters').UNREAD,this.$MercuryThreadlistContainer19,true,this.props.source);}.bind(this),this.$MercuryThreadlistContainer13=function(){if(!this.state.isSearching&&!this.state.isLoading&&!this.$MercuryThreadlistContainer1.hasLoadedThreadlist(this.props.folder,this.props.filter))this.$MercuryThreadlistContainer8(this.props.folder,this.props.filter,this.$MercuryThreadlistContainer9(this.props.folder)+c('MercuryThreadlistConstants').JEWEL_MORE_COUNT+1);}.bind(this),this.$MercuryThreadlistContainer19=function(){if(!this.$MercuryThreadlistContainer1||!this.$MercuryThreadlistContainer2)return;var t=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c('MessagingTag').PENDING,c('MercuryFilters').UNREAD);this.$MercuryThreadlistContainer2.getMultiThreadMeta(t,function(u){this.setState({unreadMessageRequestThreads:t.map(function(v){return u[v];})});}.bind(this));}.bind(this),this.$MercuryThreadlistContainer15=function(t,u){this.setState({isLoading:u,searchThreads:[]},function(){return this.$MercuryThreadlistContainer7(m,c('MercuryFilters').ALL,t);}.bind(this));}.bind(this),this.$MercuryThreadlistContainer14=function(t){this.setState({isSearching:!!t});}.bind(this),p;}n.prototype.componentDidMount=function(){c('Bootloader').loadModules(["MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads"],function(o,p,q){this.$MercuryThreadlistContainer1=o.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer2=q.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer3=function(){var r=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c('MessagingTag').INBOX,this.props.filter);if(r.length===0)return r;var s=this.$MercuryThreadlistContainer2.getThreadMetaNow(r[r.length-1]);if(!s)return r;var t=s.timestamp,u=this.$MercuryThreadlistContainer1.getThreadlistUntilTimestamp(t,c('MessagingTag').PENDING,this.props.filter);if(c('MercuryConfig').MessengerInboxRequests){u.sort(function(w,x){var y=this.$MercuryThreadlistContainer2.getThreadMetaNow(w),z=this.$MercuryThreadlistContainer2.getThreadMetaNow(x);return (z&&z.timestamp)-(y&&y.timestamp);}.bind(this));var v=this.$MercuryThreadlistContainer4(r,u);return r.concat(v).sort(function(w,x){var y=typeof w==='string'?this.$MercuryThreadlistContainer2.getThreadMetaNow(w):this.$MercuryThreadlistContainer2.getThreadMetaNow(w[0]),z=typeof x==='string'?this.$MercuryThreadlistContainer2.getThreadMetaNow(x):this.$MercuryThreadlistContainer2.getThreadMetaNow(x[0]);return (z&&z.timestamp)-(y&&y.timestamp);}.bind(this));}return r.concat(u).sort(function(w,x){var y=this.$MercuryThreadlistContainer2.getThreadMetaNow(w),z=this.$MercuryThreadlistContainer2.getThreadMetaNow(x);return (z&&z.timestamp)-(y&&y.timestamp);}.bind(this));}.bind(this);this.$MercuryThreadlistContainer5=p.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer6=new (c('SubscriptionsHandler'))();this.$MercuryThreadlistContainer6.addSubscriptions(this.$MercuryThreadlistContainer5.subscribe('threadlist-updated',function(r,s){this.$MercuryThreadlistContainer7(this.props.folder,this.props.filter);if(c('MercuryConfig').MessengerInboxRequests){this.props.folder===c('MessagingTag').INBOX&&this.$MercuryThreadlistContainer7(c('MessagingTag').PENDING,this.props.filter);this.props.folder===c('MessagingTag').PENDING&&this.$MercuryThreadlistContainer7(c('MessagingTag').INBOX,this.props.filter);}}.bind(this)));if(c('MercuryConfig').MessengerInboxRequests)this.$MercuryThreadlistContainer8(c('MessagingTag').PENDING,this.props.filter,this.$MercuryThreadlistContainer9(c('MessagingTag').PENDING)+c('MercuryThreadlistConstants').JEWEL_MORE_COUNT+1);this.$MercuryThreadlistContainer10(this.props.folder,this.props.filter);}.bind(this),'MercuryThreadlistContainer.react');};n.prototype.componentWillReceiveProps=function(o){if(o.folder!==this.props.folder||o.filter!==this.props.filter)this.$MercuryThreadlistContainer10(o.folder,o.filter);};n.prototype.componentWillUnmount=function(){this.$MercuryThreadlistContainer11();this.$MercuryThreadlistContainer12();this.$MercuryThreadlistContainer6&&this.$MercuryThreadlistContainer6.release();};n.prototype.render=function(){var o=this.props,p=o.ChildClass,q=o.folder,r=o.filter,s=babelHelpers.objectWithoutProperties(o,['ChildClass','folder','filter']),t=this.state.isSearching?this.state.threads.get(m)||[]:this.state.threads.get(q)||[];return c('React').createElement(p,babelHelpers['extends']({},s,{filter:this.props.filter,folder:q,isLoaded:!!this.$MercuryThreadlistContainer1&&this.$MercuryThreadlistContainer1.hasLoadedThreadlist(q,r),isLoading:this.state.isLoading,isSearching:this.state.isSearching,newMessageRequestThreads:this.state.unreadMessageRequestThreads,onLoadMoreRequest:this.$MercuryThreadlistContainer13,onRenderThreads:this.props.onRenderThreads,onQuery:this.$MercuryThreadlistContainer14,onSearchResults:this.$MercuryThreadlistContainer15,onMessageRequestsClick:this.props.onMessageRequestsClick,p2pJewelBannerContainer:this.$MercuryThreadlistContainer16(),threads:t}));};n.prototype.$MercuryThreadlistContainer4=function(o,p){var q=[],r=0;for(var s=0;s<=p.length-j;s++){var t=s+j-1,u=this.$MercuryThreadlistContainer2.getThreadMetaNow(p[s]),v=this.$MercuryThreadlistContainer2.getThreadMetaNow(p[t]);if(u.timestamp-v.timestamp<=k){var w=this.$MercuryThreadlistContainer2.getThreadMetaNow(p[r]);if(w.timestamp-u.timestamp>k||s===0)q.push([]);var x=r==0&&s==0?0:r+1;for(x;x<=t;x++)q[q.length-1].push(p[x]);r=t>r?t:r;}else{var y=t===p.length-1?p.length-1:s,z=r==0&&s==0?0:r+1;for(z;z<=y;z++)o.push(p[z]);r=y>r?y:r;}}return q;};n.prototype.$MercuryThreadlistContainer16=function(){return c('React').createElement(c('P2PJewelBannerContainer.react'),null);};n.prototype.$MercuryThreadlistContainer10=function(o,p){if(!c('MercuryConfig').MessengerInboxRequests&&o===c('MessagingTag').INBOX&&this.props.source!==c('MercuryAPIArgsSource').JEWEL)this.$MercuryThreadlistContainer17();if(!this.$MercuryThreadlistContainer18(o,p)){this.$MercuryThreadlistContainer8(o,p,this.props.threadCount||c('MercuryThreadlistConstants').JEWEL_THREAD_COUNT+3);}else if(this.state.isLoading){this.setState({isLoading:false},function(){this.$MercuryThreadlistContainer7(o,p);}.bind(this));}else this.$MercuryThreadlistContainer7(o,p);};n.prototype.$MercuryThreadlistContainer8=function(o,p,q){if(!this.$MercuryThreadlistContainer1)return;this.$MercuryThreadlistContainer12();this.threadListReqsInFlight++;this.setState({isLoading:true},function(){var r=this.$MercuryThreadlistContainer1.getFilteredThreadlist(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,q,o,p||c('MercuryFilters').ALL,function(s){this.threadListReqsInFlight--;if(this.threadListReqsInFlight===0)this.setState({isLoading:false});}.bind(this),true,this.props.source);this.$MercuryThreadlistContainer20={subscriberID:r,folder:o,filter:p};}.bind(this));};n.prototype.$MercuryThreadlistContainer7=function(o,p,q){if(!this.$MercuryThreadlistContainer1||!this.$MercuryThreadlistContainer2)return;this.$MercuryThreadlistContainer11();var r=void 0;if(c('MercuryConfig').MessengerInboxRequests&&o===c('MessagingTag').INBOX){r=this.$MercuryThreadlistContainer3();}else r=q||this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(o,p);var s=[].concat.apply([],r);this.$MercuryThreadlistContainer21=this.$MercuryThreadlistContainer2.getMultiThreadMeta(s,function(t){this.setState({threads:this.state.threads.set(o,this.$MercuryThreadlistContainer22(r,t))});}.bind(this));};n.prototype.$MercuryThreadlistContainer22=function(o,p){return o.map(function(q){if(Array.isArray(q)){return q.map(function(r){return p[r];});}else return p[q];});};n.prototype.$MercuryThreadlistContainer18=function(o,p){return !!(this.$MercuryThreadlistContainer1&&(this.$MercuryThreadlistContainer1.getThreadCount(o,p)>=c('MercuryThreadlistConstants').JEWEL_THREAD_COUNT+3||this.$MercuryThreadlistContainer1.hasLoadedThreadlist(o,p)));};n.prototype.$MercuryThreadlistContainer9=function(o){var p=this.state.threads.get(o);return p?p.length:0;};n.prototype.$MercuryThreadlistContainer11=function(){this.$MercuryThreadlistContainer2&&this.$MercuryThreadlistContainer21&&this.$MercuryThreadlistContainer2.unsubscribe(this.$MercuryThreadlistContainer21);};n.prototype.$MercuryThreadlistContainer12=function(){this.$MercuryThreadlistContainer1&&this.$MercuryThreadlistContainer20&&this.$MercuryThreadlistContainer1.unsubscribe(this.$MercuryThreadlistContainer20.subscriberID,this.$MercuryThreadlistContainer20.folder,this.$MercuryThreadlistContainer20.filter);};n.propTypes={ChildClass:l.func.isRequired,filter:l.string.isRequired,folder:l.string.isRequired,onMessageRequestsClick:l.func,showCount:l.bool,showPresence:l.bool,source:l.string,threadCount:l.number,viewer:l.string.isRequired,onRenderThreads:l.func};n.defaultProps={source:c('MercuryAPIArgsSource').JEWEL};f.exports=n;}),null);