if (self.CavalryLogger) { CavalryLogger.start_js(["XID1R"]); }

__d('MessengerComposerInput.react',['cx','fbt','Bootloader','CompositeDraftDecorator','DebouncedMentionsTextEditor.react','DraftModifier','DOMDimensions','EditorState','EmojiFormat','MessengerActions','MessengerEmojiSpan.react','MessengerEmoticonSpan.react','MessengerMentionsEntityDecorator.react','MessengerSingleSectionContactList.react','Event','immutable','MentionsLayer.react','MercuryConfig','MercuryIDs','MercuryThreadIDMap','MercuryThreadSnippet.react','MercuryThreadTitle.react','MercuryTimestamp','MercuryTriodeSourceUtil','MessengerBotMenuButton.react','MessengerConstants','messengerDomIDsRe','MessengerEditorStateManager','MessengerMentionSource','MessengerTabIndices','messengerUploadFilesUtilRe','MessengerURLUploader','React','ReactDOM','Run','TypingDetectorController','URLMatcher','clearImmediate','createMessengerMentionDraftEntity','createMentionsSearchSourceFromParticipants','debounce','getEntityMatcher','getProfileRangesForContentState','getThreadTypeNameFromThreadType','getVisibleValueForContentStateWithMessengerEmoji','handleBeforeInputForMessengerEmoji','handleBeforeInputForMessengerEmoticon','handleSoftNewlineForMessengerEmoticon','insertEmoticonIntoEditorState','insertMentionIntoEditorState','insertMessengerEmojiIntoContentState','isSoftNewlineEvent','setImmediate','shouldNotRenderSegoe','throttle'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('messengerDomIDsRe').ids,m=c('React').PropTypes,n=1,o=/^image\//,p='handled',q=8,r='not-handled';j=babelHelpers.inherits(s,c('React').PureComponent);k=j&&j.prototype;function s(v){k.constructor.call(this,v);t.call(this);this.$MessengerInput11=this.$MessengerInput11.bind(this);this.state=this.$MessengerInput12();this.$MessengerInput6=c('debounce')(function(w){if(this.props.isComposing&&w.isComposing)return;if(!this.props.thread||!w.thread||u(this.props,w))this.$MessengerInput13();}.bind(this),300);this.$MessengerInput7=c('throttle')(function(){if(this.$MessengerInput10){var w=c('DOMDimensions').getElementDimensions(c('ReactDOM').findDOMNode(this)).height;if(this.$MessengerInput1!==w)this.props.onResize&&this.props.onResize();this.$MessengerInput1=w;}}.bind(this),100);}s.prototype.$MessengerInput12=function(v){return {editorState:this.$MessengerInput14(c('MessengerEditorStateManager').get(this.props.threadID),v)};};s.prototype.componentDidMount=function(){this.$MessengerInput10=true;this.$MessengerInput1=c('DOMDimensions').getElementDimensions(c('ReactDOM').findDOMNode(this)).height;this.$MessengerInput13();this.$MessengerInput2=new (c('MessengerURLUploader'))(this.getValue,c('ReactDOM').findDOMNode(this.refs.input),this.props.threadID);c('Run').onUnload(this.$MessengerInput15);this.$MessengerInput3=c('Event').listen(window,'blur',this.$MessengerInput15);this.$MessengerInput4=c('Event').listen(window,'focus',this.$MessengerInput16);this.$MessengerInput5=c('debounce')(function(){this.$MessengerInput17();}.bind(this),1000);};s.prototype.componentWillUpdate=function(v){if(this.props.threadID!==v.threadID)this.$MessengerInput17();};s.prototype.componentDidUpdate=function(v,w){this.$MessengerInput9=c('setImmediate')(this.$MessengerInput7);if(this.props.threadID!==v.threadID){this.$MessengerInput13();}else this.$MessengerInput6(v);if(w.editorState!==this.state.editorState)this.props.onChange&&this.props.onChange(this.getValue());};s.prototype.componentWillUnmount=function(){this.$MessengerInput10=false;this.$MessengerInput8&&this.$MessengerInput8.destroy();this.props.threadID&&this.$MessengerInput17();this.$MessengerInput9&&c('clearImmediate')(this.$MessengerInput9);this.$MessengerInput3&&this.$MessengerInput3.remove();this.$MessengerInput4&&this.$MessengerInput4.remove();};s.prototype.insertEmoticon=function(v){var w=c('insertEmoticonIntoEditorState')(v,this.state.editorState);if(w!==this.state.editorState)this.$MessengerInput18(w);};s.prototype.insertEmoji=function(v){var w=this.state.editorState,x=c('insertMessengerEmojiIntoContentState')(c('EmojiFormat').codeArrayToCodeString(v),w.getCurrentContent(),w.getSelection(),w.getCurrentInlineStyle()),y=c('EditorState').push(w,x,'insert-characters');if(y!==this.state.editorState)this.$MessengerInput18(c('EditorState').forceSelection(y,x.getSelectionAfter()));};s.prototype.$MessengerInput22=function(){var v=this.props.fileUploader;return Boolean(v&&v.get('uploadedFiles').size>0);};s.prototype.$MessengerInput13=function(){if(!this.$MessengerInput10)return;this.$MessengerInput24();if(this.$MessengerInput2){this.$MessengerInput2.setThreadID(this.props.threadID);this.$MessengerInput2.clearShareData();}var v=this.$MessengerInput12();if(this.props.mentionsEnabled){var w=this.props,x=w.participants,y=w.viewer,z=w.thread;v.mentionsSource=c('createMentionsSearchSourceFromParticipants')(y,x&&x.toArray(),z);}this.setState(v,function(){if(this.props.threadID!==c('MessengerConstants').NEW_THREAD_KEY)c('setImmediate')(function(){if(!this.props.disableAutofocus)this.focus();}.bind(this));}.bind(this));};s.prototype.$MessengerInput17=function(){if(!this.props.threadID)return;c('MessengerEditorStateManager').set(this.props.threadID,this.state.editorState);};s.prototype.$MessengerInput25=function(v){this.setState({editorState:this.$MessengerInput14(c('EditorState').createEmpty()),addedMentionsCount:0,mentionsTriggeredCount:0,mentionsTriggerSource:null},v);};s.prototype.$MessengerInput24=function(){this.$MessengerInput8&&this.$MessengerInput8.destroy();this.$MessengerInput8=null;var v=this.props.viewer;if(!v)return;var w=c('ReactDOM').findDOMNode(this.refs.input);if(this.props.threadID!==c('MessengerConstants').NEW_THREAD_KEY&&w)this.$MessengerInput8=new (c('TypingDetectorController'))(c('MercuryIDs').getUserIDFromThreadID(this.props.threadID),w,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),null,c('MercuryThreadIDMap').getForFBID(v).getServerIDFromClientIDNow(this.props.threadID),this.getValue);};s.prototype.$MessengerInput23=function(){var v=this.props.fileUploader;if(v){c('messengerUploadFilesUtilRe').sendAttchments(v,this.props.onFileUpload);c('MessengerActions').cleanFiles(this.props.threadID);}};s.prototype.$MessengerInput21=function(){var v=this.getMentions();if(this.props.onMessageSend&&this.props.onMessageSend(this.getValue(),{shareable_attachment:this.getShareData(),profile_ranges:v},function(w){var x,y=this;if(c('MercuryConfig').WWWMessengerURLPreview)c('MessengerActions').removeSharePreview(this.props.threadID);if(w&&this.props.mentionsEnabled&&(v&&v.length||this.state.addedMentionsCount||this.state.mentionsTriggeredCount||this.state.mentionsTriggerSource))(function(){var z=y.state,aa=z.addedMentionsCount,ba=z.mentionsTriggeredCount,ca=z.mentionsTriggerSource,da=y.props,ea=da.thread,fa=da.participants,ga=w;c('Bootloader').loadModules(["MessengerMentionsTypedLogger","MessengerMentionsLoggerEvents"],function(ha,ia){new ha().setEvent(ia.MENTION).setGroupSize(fa&&fa.size).setNumDelivered(v&&v.length||0).setNumSelects(aa).setNumTriggers(ba).setThreadid(ea&&ea.thread_id).setThreadType(c('getThreadTypeNameFromThreadType')(ea&&ea.thread_type)).setOfflineThreadid(ga.offline_threading_id).updateExtraData({source:ca}).log();},'MessengerComposerInput.react');})();}.bind(this)))this.$MessengerInput25(function(){this.$MessengerInput17();this.$MessengerInput8&&this.$MessengerInput8.resetState();}.bind(this));};s.prototype.getMentions=function(){return c('getProfileRangesForContentState')(this.state.editorState.getCurrentContent());};s.prototype.getInput=function(){return this.refs.input;};s.prototype.render=function(){var v=this.props,w=v.participants,x=v.thread,y=v.viewer,z=null;if(w&&x&&y){z=i._("Conversation with {participantListAsShownInThreadList}. Updated {lastUpdatedTime} by {recentUpdateStringAsShownInThreadList}",[i.param('participantListAsShownInThreadList',this.$MessengerInput26(x,y)),i.param('lastUpdatedTime',c('MercuryTimestamp').getAbsoluteTimestamp(x.timestamp)),i.param('recentUpdateStringAsShownInThreadList',this.$MessengerInput27(w,x,y))]);}else z=i._("Composing a new message");var aa=null;if(this.props.threadID&&this.props.pageID)aa=c('React').createElement('div',{ref:'botsMenuContainer',className:"_3km1"},c('React').createElement(c('MessengerBotMenuButton.react'),{flyoutAlignment:'left',threadID:this.props.threadID,pageID:this.props.pageID,className:"_3km2"}));var ba='';if(this.props.disableInput){ba=i._("Composer is disabled for this thread.").toString();}else if(this.props.thread&&!this.props.thread.is_canonical){ba=i._("Type a message, \u0040name...").toString();}else ba=i._("Type a message...").toString();return c('React').createElement('div',{className:"_kmc"+(this.props.smallerEqual640?' '+"_2swd":'')+(c('shouldNotRenderSegoe')(this.state.editorState.getCurrentContent().getPlainText())?' '+"_2por":'')+(' '+"navigationFocus"),onClick:this.focus,role:'presentation'},this.props.showMenu?aa:null,c('React').createElement('div',{className:"_3-8x"+(this.props.showMenu?' '+"_3km3":'')+(' '+"_3oh-")},c('React').createElement(c('DebouncedMentionsTextEditor.react'),{autoHighlight:true,'aria-controls':l.CONVERSATION,ariaDescribedBy:l.COMPOSER_INPUT_DESCRIPTION,ariaLabel:ba,editorState:this.state.editorState,handleBeforeInput:this.$MessengerInput28,handleContentReturn:this.$MessengerInput19,handlePastedFiles:this.$MessengerInput11,handleReturn:this.$MessengerInput19,maxResults:q,readOnly:this.props.disableInput,mentionCreationFn:this.$MessengerInput29,mentionResultsComponent:c('MentionsLayer.react'),mentionResultsProps:{typeaheadView:c('MessengerSingleSectionContactList.react'),typeaheadViewProps:{className:"_13iv",viewer:this.props.viewer},position:'above',autoflip:true},mentionsSource:this.state.mentionsSource,onChange:this.$MessengerInput18,placeholder:ba,ref:'input',spellCheck:true,stripPastedStyles:true,tabIndex:this.props.threadID===c('MessengerConstants').NEW_THREAD_KEY?c('MessengerTabIndices').COMPOSER_INPUT:0,textAlignment:'left',onAddMention:this.$MessengerInput30,onShowMentions:this.$MessengerInput31}),c('React').createElement('div',{className:"_5ca7",id:l.COMPOSER_INPUT_DESCRIPTION},z)));};s.prototype.$MessengerInput26=function(v,w){return c('React').createElement(c('MercuryThreadTitle.react'),{thread:v,viewer:w});};s.prototype.$MessengerInput27=function(v,w,x){return c('React').createElement(c('MercuryThreadSnippet.react'),{participants:v,shouldAlwaysRenderSender:true,shouldRenderYou:true,thread:w,viewer:x});};s.prototype.$MessengerInput14=function(v,w){var x=this.$MessengerInput32(v),y=c('EditorState').set(v,{decorator:x});return w||this.props.disableAutofocus?y:c('EditorState').moveFocusToEnd(y);};s.prototype.$MessengerInput32=function(v){var w=c('MessengerEmoticonSpan.react'),x=v.getCurrentContent(),y=[{strategy:c('getEntityMatcher')(function(z){return z.getType()==='EMOTICON';},x.getEntity),component:w}];y.push({strategy:c('getEntityMatcher')(function(z){return z.getType()==='EMOJI';},x.getEntity),component:c('MessengerEmojiSpan.react')});y.push({strategy:c('getEntityMatcher')(function(z){return z.getType()==='MENTION';},x.getEntity),component:c('MessengerMentionsEntityDecorator.react')});return new (c('CompositeDraftDecorator'))(y);};s.prototype.$MessengerInput33=function(v,w){var x=c('handleBeforeInputForMessengerEmoticon')(w,v);if(x===w)return false;this.setState({editorState:x});return true;};s.prototype.$MessengerInput34=function(v,w){var x=c('handleBeforeInputForMessengerEmoji')(w,v);if(x===w)return false;this.setState({editorState:x});return true;};s.prototype.handleTextDropped=function(v){var w=this.state.editorState,x=w.getSelection();if(x.get('hasFocus'))return;var y=c('DraftModifier').replaceText(w.getCurrentContent(),x,v,w.getCurrentInlineStyle()),z=c('EditorState').push(w,y,'insert-fragment');this.$MessengerInput18(z);};s.prototype.getShareData=function(){if(c('MercuryConfig').WWWMessengerURLPreview){var v=this.props.sharePreview;if(v&&v.type&&v.params)return {share_type:v.type,share_params:v.params.get('data')};return null;}var w=c('URLMatcher').match(this.getValue());if(w===this.$MessengerInput2.getMatchedURL())return this.$MessengerInput2.getData();return null;};s.prototype.exitCurrentMode=function(){this.refs.input&&this.refs.input.exitCurrentMode();};s.prototype.triggerSend=function(){if(this.$MessengerInput22())this.$MessengerInput23();if(this.getValue().trim().length>0||this.$MessengerInput20())this.$MessengerInput21();};s.prototype.$MessengerInput20=function(){var v=this.props.sharePreview;return !!(v&&v.params&&v.type);};s.prototype.addMention=function(v){var w=c('insertMentionIntoEditorState')(v,this.state.editorState,0,this.$MessengerInput29);if(!this.state.mentionsTriggerSource)this.setState({mentionsTriggerSource:c('MessengerMentionSource').REPLY});this.$MessengerInput18(w);this.$MessengerInput30();};s.propTypes={disableAutofocus:m.bool,fileUploader:m.object,handleOnlyImageUploads:m.bool.isRequired,isComposing:m.bool,mentionsEnabled:m.bool,pageID:m.string,participants:m.instanceOf(c('immutable').Map),sharePreview:m.object,showMenu:m.bool,disableInput:m.bool,smallerEqual640:m.bool,thread:m.object,threadID:m.string,viewer:m.string,onBeforeInput:m.func,onChange:m.func,onFileUpload:m.func,onResize:m.func,onMessageSend:m.func};var t=function v(){this.$MessengerInput10=false;this.$MessengerInput18=function(w){if(w!==this.state.editorState)this.setState({editorState:w},function(){this.$MessengerInput5();}.bind(this));}.bind(this);this.$MessengerInput19=function(event,w){if(c('isSoftNewlineEvent')(event)){var x=c('handleSoftNewlineForMessengerEmoticon');this.setState({editorState:x(w)});return p;}this.setState({},function(){if(this.getValue().trim().length>0||this.$MessengerInput20())this.$MessengerInput21();if(this.$MessengerInput22())this.$MessengerInput23();}.bind(this));return p;}.bind(this);this.getValue=function(){return c('getVisibleValueForContentStateWithMessengerEmoji')(this.state.editorState.getCurrentContent());}.bind(this);this.focus=function(){this.refs.input&&this.refs.input.focus();}.bind(this);this.$MessengerInput28=function(w,x){this.props.onBeforeInput&&this.props.onBeforeInput(w,x);var y=this.$MessengerInput33(w,x),z=this.$MessengerInput34(w,x);return y||z?p:r;}.bind(this);this.$MessengerInput11=function(w){var x=this.props.handleOnlyImageUploads?w.filter(function(y){return y&&o.test(y.type);}):w;if(x.length){c('MercuryConfig').WWWMessengerUploadFilesPreview?c('MessengerActions').prepareFilesForSend(this.props.threadID,x):this.props.onFileUpload(x);return p;}return r;}.bind(this);this.$MessengerInput15=function(){this.$MessengerInput17();}.bind(this);this.$MessengerInput16=function(){this.setState(this.$MessengerInput12(true));}.bind(this);this.$MessengerInput30=function(){var w=(this.state.addedMentionsCount||0)+1;this.setState({addedMentionsCount:w});}.bind(this);this.$MessengerInput31=function(w,x){var y=(this.state.mentionsTriggeredCount||0)+1,z={mentionsTriggeredCount:y};if(!this.state.mentionsTriggerSource)z.mentionsTriggerSource=x===n?c('MessengerMentionSource').ATSIGN:c('MessengerMentionSource').TYPEAHEAD;this.setState(z);}.bind(this);this.$MessengerInput29=function(w){return c('createMessengerMentionDraftEntity')(this.state.editorState.getCurrentContent(),w);}.bind(this);};function u(v,w){var x=v.participants,y=w.participants;if(!x||!y)return true;var z=x.filter(Boolean),aa=y.filter(Boolean);return z.size!==aa.size||!z.equals(aa);}f.exports=s;}),null);