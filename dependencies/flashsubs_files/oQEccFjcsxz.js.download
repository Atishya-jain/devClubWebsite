if (self.CavalryLogger) { CavalryLogger.start_js(["+yGai"]); }

__d('VideoCallTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:VideoCallLoggerConfig',this.$VideoCallTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:VideoCallLoggerConfig',this.$VideoCallTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$VideoCallTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$VideoCallTypedLogger1=babelHelpers['extends']({},this.$VideoCallTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$VideoCallTypedLogger1.event=j;return this;};h.prototype.setMessage=function(j){this.$VideoCallTypedLogger1.message=j;return this;};var i={event:true,message:true};f.exports=h;}),null);
__d('MessengerRTCIncomingDialog.react',['cx','fbt','ImageBlock.react','MercuryIDs','MercuryParticipants','messengerDialogsRe','messengerContactImageReact','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','MessengerSpinner.react','React','StoreAndPropBasedStateMixin'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerContactImageReact').jsComponent,k=c('messengerDialogBodyReact').jsComponent,l=c('React').PropTypes,m=50,n=c('React').createClass({displayName:'MessengerRTCIncomingDialog',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{callerID:l.string.isRequired,onAccept:l.func.isRequired,onDecline:l.func.isRequired,isVideoCall:l.bool.isRequired},statics:{calculateState:function o(p){return {callerParticipant:c('MercuryParticipants').getOrFetch(c('MercuryIDs').getParticipantIDFromUserID(p.callerID))};}},render:function o(){return c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:false,shown:true,onToggle:this._handleToggle,width:400},c('React').createElement(c('MessengerDialogHeader.react'),null,this._dialogTitle()),c('React').createElement(k,null,this._renderDialogBody()),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Decline"),onClick:this._handleDecline,type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Accept"),onClick:this._handleAccept,type:'primary'})));},_dialogTitle:function o(){if(this.props.isVideoCall)return i._("Incoming video call");return i._("Incoming audio call");},_renderDialogBody:function o(){var p=this.state.callerParticipant;if(!p)return c('React').createElement(c('MessengerSpinner.react'),null);return c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(j,{isMessengerUser:p.is_messenger_user,size:m,src:p.big_image_src||p.image_src}),c('React').createElement('div',{className:"_2n1r"},c('React').createElement('div',{className:"_2n1s"},i._("{caller name} is calling you.",[i.param('caller name',p.name)])),c('React').createElement('div',{className:"_2n1t"},i._("The call will start as soon as you answer."))));},_handleDecline:function o(event){event.preventDefault();c('messengerDialogsRe').removeAllDialogs();this.props.onDecline();},_handleAccept:function o(event){event.preventDefault();c('messengerDialogsRe').removeAllDialogs();this.props.onAccept();},_handleToggle:function o(p){if(!p){c('messengerDialogsRe').removeAllDialogs();this.props.onDecline();}}});f.exports=n;}),null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('FBRTCDispatcher'));}j.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=j;}),null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','ChannelConstants','FBRTCDispatcher','FBRTCStore','VideoCallTypedLogger','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=false,k=0,l=null,m='call_block_setting_changed';h=babelHelpers.inherits(n,c('FBRTCStore'));i=h&&h.prototype;n.prototype.init=function(o){this.$FBRTCCallBlockingStore1(o);c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};n.prototype.__onDispatch=function(o){if(o.type!==m)return;this.$FBRTCCallBlockingStore1(o.data);};n.prototype.$FBRTCCallBlockingStore1=function(o){switch(o){case 0:j=false;this.$FBRTCCallBlockingStore3();break;case -1:j=true;this.$FBRTCCallBlockingStore3();break;default:j=true;this.$FBRTCCallBlockingStore4(o);}this.__emitChange();};n.prototype.$FBRTCCallBlockingStore4=function(o){if(l===null)l=c('setTimeoutAcrossTransitions')(this.turnOnVideoCalling.bind(this),o*1000);};n.prototype.getBlockingStatus=function(){return j;};n.prototype.turnOnVideoCalling=function(){new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};n.prototype.turnOffVideoCalling=function(o){k=o;new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:o}).send();};n.prototype.$FBRTCCallBlockingStore3=function(){if(l){clearTimeout(l);l=null;}};n.prototype.$FBRTCCallBlockingStore5=function(){c('FBRTCDispatcher').dispatch({type:m,data:0});new (c('VideoCallTypedLogger'))().setEvent(m).setMessage('enable').log();};n.prototype.$FBRTCCallBlockingStore6=function(){c('FBRTCDispatcher').dispatch({type:m,data:k});new (c('VideoCallTypedLogger'))().setEvent(m).setMessage('disable_'+k).log();};n.prototype.$FBRTCCallBlockingStore2=function(o,p){c('FBRTCDispatcher').dispatch({type:m,data:p.obj.value});};function n(){h.apply(this,arguments);}f.exports=new n();}),null);
__d('FBRTCIceStatsParser',[],(function a(b,c,d,e,f,g){var h=null;i.getInstance=function(){'use strict';if(!h)h=new i();return h;};function i(){'use strict';}i.prototype.extractIceInfo=function(j){'use strict';var k=[],l=j.split("\r\n");for(var m=0;m<l.length;m++){var n=l[m];if(this.$FBRTCIceStatsParser1(n))k.push({gen:this.$FBRTCIceStatsParser2(n),type:this.$FBRTCIceStatsParser3(n)});}return k;};i.prototype.$FBRTCIceStatsParser1=function(j){'use strict';return j.indexOf('candidate:')>-1;};i.prototype.$FBRTCIceStatsParser2=function(j){'use strict';var k=0,l=j.match(/generation (\d+)/);if(l)k=parseInt(l[1],10);return k;};i.prototype.$FBRTCIceStatsParser3=function(j){'use strict';var k=j.match(/typ (host|relay|srflx|prflx)/);if(k){return k[1];}else return 'unknown';};f.exports=i;}),null);
__d('FBRTCCallSummary',['FBRTCConstants','FBRTCIceStatsParser','FBRTCLogger','FBRTCUtils','SiteData','UserAgentData','performanceNow'],(function a(b,c,d,e,f,g){var h=5*60*1000,i={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};j.CURRENT_SUMMARY_VERSION=19;function j(k){'use strict';this.peerID=k.peerID;this.callID=k.callID;this.$FBRTCCallSummary1=k.isCaller;this.$FBRTCCallSummary2=c('FBRTCUtils').getLocalUploadLogLevel();this.$FBRTCCallSummary3=new Date().valueOf();this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5={};this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummary10=null;this.$FBRTCCallSummary11=null;this.$FBRTCCallSummary12={};this.$FBRTCCallSummary13={};this.$FBRTCCallSummary14={};this.$FBRTCCallSummary15={};this.$FBRTCCallSummary16={};this.$FBRTCCallSummary17={};this.$FBRTCCallSummary18=null;this.$FBRTCCallSummary19=c('performanceNow')();this.$FBRTCCallSummary20=0;this.$FBRTCCallSummary21={};this.$FBRTCCallSummary22=this.$FBRTCCallSummary19;this.$FBRTCCallSummary23=0;this.$FBRTCCallSummary24={};this.addExtraInfo(c('FBRTCLogger').Key.DEVICE_INFO,this.$FBRTCCallSummary25());this.$FBRTCCallSummary26();this.$FBRTCCallSummary27=c('FBRTCIceStatsParser').getInstance();this.$FBRTCCallSummary28=c('FBRTCLogger').getInstance();}j.prototype.toJsonString=function(){'use strict';this.$FBRTCCallSummary10=new Date().valueOf();return JSON.stringify({version:j.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary1,uploadLogLevel:this.$FBRTCCallSummary2,clientVersion:this.$FBRTCCallSummary18,callType:this.$FBRTCCallSummary29,isUsingMultiway:this.$FBRTCCallSummary30,conferenceName:this.$FBRTCCallSummary31,serverInfoData:this.$FBRTCCallSummary32,localVideoDuration:this.$FBRTCCallSummary33,remoteVideoDuration:this.$FBRTCCallSummary34,startTime:this.$FBRTCCallSummary3,trigger:this.$FBRTCCallSummary4,signalingTime:this.$FBRTCCallSummary5,endCallReason:this.$FBRTCCallSummary6,endCallSubreason:this.$FBRTCCallSummary7,isRemoteEnded:this.$FBRTCCallSummary8,lastUpdatedTime:this.$FBRTCCallSummary9,lastSerializedTime:this.$FBRTCCallSummary10,unsetOnRetrieve:this.$FBRTCCallSummary11,openCount:this.$FBRTCCallSummary23,extraInfo:this.$FBRTCCallSummary24,pcStats:this.$FBRTCCallSummary12,captureStats:this.$FBRTCCallSummary13,gen0IceSentCount:this.$FBRTCCallSummary14,gen0IceReceivedCount:this.$FBRTCCallSummary15,iceSentCount:this.$FBRTCCallSummary16,iceReceivedCount:this.$FBRTCCallSummary17,newSignalingTime:this.$FBRTCCallSummary21,accumulatedCallTime:this.$FBRTCCallSummary35()});};j.fromJsonString=function(k){'use strict';var l;try{l=JSON.parse(k);}catch(n){return null;}if(l.version!==j.CURRENT_SUMMARY_VERSION)return null;if(!Object.prototype.hasOwnProperty.call(l,'peerID')||!Object.prototype.hasOwnProperty.call(l,'callID')||!Object.prototype.hasOwnProperty.call(l,'isCaller')||!Object.prototype.hasOwnProperty.call(l,'startTime')||!Object.prototype.hasOwnProperty.call(l,'trigger')||!Object.prototype.hasOwnProperty.call(l,'signalingTime')||!Object.prototype.hasOwnProperty.call(l,'endCallReason')||!Object.prototype.hasOwnProperty.call(l,'isRemoteEnded')||!Object.prototype.hasOwnProperty.call(l,'lastUpdatedTime')||!Object.prototype.hasOwnProperty.call(l,'lastSerializedTime'))return null;var m=new j({peerID:l.peerID,callID:l.callID,isCaller:l.isCaller});m.$FBRTCCallSummary2=l.uploadLogLevel;m.$FBRTCCallSummary18=l.clientVersion;m.$FBRTCCallSummary3=l.startTime;m.$FBRTCCallSummary4=l.trigger;m.$FBRTCCallSummary5=l.signalingTime;m.$FBRTCCallSummary6=l.endCallReason;m.$FBRTCCallSummary7=l.endCallSubreason;m.$FBRTCCallSummary8=l.isRemoteEnded;m.$FBRTCCallSummary9=l.lastUpdatedTime;m.$FBRTCCallSummary10=l.lastSerializedTime;if(l.callType)m.$FBRTCCallSummary29=l.callType;if(l.isUsingMultiway!=null)m.$FBRTCCallSummary30=l.isUsingMultiway;if(l.conferenceName)m.$FBRTCCallSummary31=l.conferenceName;if(l.serverInfoData)m.$FBRTCCallSummary32=l.serverInfoData;if(l.localVideoDuration)m.$FBRTCCallSummary33=l.localVideoDuration;if(l.remoteVideoDuration)m.$FBRTCCallSummary34=l.remoteVideoDuration;if(l.unsetOnRetrieve)m.$FBRTCCallSummary11=l.unsetOnRetrieve;if(l.openCount)m.$FBRTCCallSummary23=l.openCount;if(l.extraInfo)m.$FBRTCCallSummary24=l.extraInfo;if(l.pcStats)m.$FBRTCCallSummary12=l.pcStats;if(l.captureStats)m.$FBRTCCallSummary13=l.captureStats;if(l.gen0IceSentCount)m.$FBRTCCallSummary14=l.gen0IceSentCount;if(l.gen0IceReceivedCount)m.$FBRTCCallSummary15=l.gen0IceReceivedCount;if(l.iceSentCount)m.$FBRTCCallSummary16=l.iceSentCount;if(l.iceReceivedCount)m.$FBRTCCallSummary17=l.iceReceivedCount;if(l.newSignalingTime)m.$FBRTCCallSummary21=l.newSignalingTime;if(l.accumulatedCallTime)m.$FBRTCCallSummary20=l.accumulatedCallTime;return m;};j.restoreOrInitialize=function(k,l,m,n,o){'use strict';var p=k.retrieveCallSummary(l,m);if(!p){p=new j({peerID:l,callID:m,isCaller:n});if(o){p.onFullMessageReceived({msg:o});p.onOfferAckSent(o);}else p.onCallStarted(c('FBRTCLogger').Trigger.UNKNOWN);c('FBRTCLogger').getInstance().logError(l,m,'Missing call summary from storage');}else if(p.$FBRTCCallSummary11){p.$FBRTCCallSummary6=null;p.$FBRTCCallSummary7=null;p.$FBRTCCallSummary8=null;delete p.$FBRTCCallSummary5[i.CALL_ENDED];delete p.$FBRTCCallSummary21[i.CALL_ENDED];p.$FBRTCCallSummary11=null;}return p;};j.logSavedSummaries=function(k){'use strict';var l=k.getLoggableSummaries(),m=l.length;if(m<=0)return;var n=c('FBRTCLogger').getInstance(),o=[];for(var p=0;p<m;p++){var q=l[p];n.logEndCallSummary(q);o.push({peerID:q.peerID,callID:q.callID});}k.removeCallSummaries(o);n.logToConsole('Logged pending summaries: '+m);};j.prototype.save=function(k){'use strict';var l=c('performanceNow')(),m=l-this.$FBRTCCallSummary22;if(m>h){this.$FBRTCCallSummary28.logInfo(this.peerID,this.callID,'Summary too old: '+m);return;}k.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummary22=l;};j.prototype.getLastUpdatedTime=function(){'use strict';return this.$FBRTCCallSummary9;};j.prototype.setLastUpdatedTime=function(k){'use strict';this.$FBRTCCallSummary9=k;};j.prototype.getExtraInfo=function(){'use strict';return this.$FBRTCCallSummary24;};j.prototype.addExtraInfo=function(k,l){'use strict';this.$FBRTCCallSummary24[k]=l;this.$FBRTCCallSummary26();};j.prototype.isCaller=function(){'use strict';return this.$FBRTCCallSummary1;};j.prototype.isNetworkReady=function(){'use strict';if(this.$FBRTCCallSummary5[i.NETWORK_READY]){return true;}else return false;};j.prototype.isAnswerReceived=function(){'use strict';if(this.$FBRTCCallSummary5[i.RECV_ANSWER]){return true;}else return false;};j.prototype.onCallStarted=function(k){'use strict';this.$FBRTCCallSummary4=k;this.$FBRTCCallSummary36(i.CALL_STARTED);this.$FBRTCCallSummary26();};j.prototype.onPopupOpened=function(){'use strict';this.$FBRTCCallSummary36(i.POPUP_OPENED);this.$FBRTCCallSummary23++;this.$FBRTCCallSummary26();};j.prototype.setPcStats=function(k){'use strict';this.$FBRTCCallSummary12=k;this.$FBRTCCallSummary26();};j.prototype.setVideoCaptureStats=function(k,l){'use strict';this.$FBRTCCallSummary13={w:k,h:l};this.$FBRTCCallSummary26();};j.prototype.setUploadLogLevel=function(k){'use strict';this.$FBRTCCallSummary2=k;this.$FBRTCCallSummary26();};j.prototype.getCallType=function(){'use strict';return this.$FBRTCCallSummary29;};j.prototype.setCallType=function(k){'use strict';this.$FBRTCCallSummary29=k;this.addExtraInfo('call_type',k);this.$FBRTCCallSummary26();};j.prototype.setVideoDurations=function(k,l){'use strict';this.$FBRTCCallSummary33=k;this.$FBRTCCallSummary34=l;this.$FBRTCCallSummary26();};j.prototype.setIsUsingMultiway=function(k){'use strict';this.$FBRTCCallSummary30=k;this.$FBRTCCallSummary26();};j.prototype.setConferenceName=function(k){'use strict';this.$FBRTCCallSummary31=k;this.$FBRTCCallSummary26();};j.prototype.setServerInfoData=function(k){'use strict';this.$FBRTCCallSummary32=k;this.$FBRTCCallSummary26();};j.prototype.onOfferAckSent=function(k){'use strict';this.onMessageSent({type:c('FBRTCConstants').PayloadType.OFFER_ACK,flag:k.flag});};j.prototype.onMessageSent=function(k){'use strict';var l=k.flag===1;switch(k.type){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCCallSummary37(l,i.SENT_OFFER,i.SENT_RETRIED_OFFER);this.$FBRTCCallSummary38(k,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCCallSummary37(l,i.SENT_ANSWER,i.SENT_RETRIED_ANSWER);this.$FBRTCCallSummary38(k,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;case c('FBRTCConstants').PayloadType.OK:this.$FBRTCCallSummary36(i.SENT_OK);break;case c('FBRTCConstants').PayloadType.PRANSWER:this.$FBRTCCallSummary36(i.SENT_PRANSWER);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCCallSummary37(l,i.SENT_OFFER_ACK,i.SENT_RETRIED_OFFER_ACK);break;case c('FBRTCConstants').PayloadType.ANSWER_ACK:this.$FBRTCCallSummary37(l,i.SENT_ANSWER_ACK,i.SENT_RETRIED_ANSWER_ACK);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary38(k,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;default:}this.$FBRTCCallSummary26();};j.prototype.$FBRTCCallSummary38=function(k,l,m){'use strict';var n=null,o=null,p=this.$FBRTCCallSummary27.extractIceInfo(k.sdp);for(var q=0;q<p.length;q++){n=p[q].gen;o=p[q].type;if(n===0)this.$FBRTCCallSummary39(l,o);this.$FBRTCCallSummary39(m,o);}};j.prototype.$FBRTCCallSummary39=function(k,l){'use strict';if(!k[l]){k[l]=1;}else k[l]=k[l]+1;};j.prototype.$FBRTCCallSummary40=function(k){'use strict';if(k.isFromMobile())this.addExtraInfo(c('FBRTCLogger').Key.PEER_IS_MOBILE,'1');};j.prototype.onFullMessageReceived=function(k){'use strict';var l=k.msg,m=l.flag===1;switch(l.type){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCCallSummary40(k);this.$FBRTCCallSummary37(m,i.RECV_OFFER,i.RECV_RETRIED_OFFER);this.$FBRTCCallSummary38(l,this.$FBRTCCallSummary15,this.$FBRTCCallSummary17);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCCallSummary40(k);this.$FBRTCCallSummary37(m,i.RECV_ANSWER,i.RECV_RETRIED_ANSWER);this.$FBRTCCallSummary38(l,this.$FBRTCCallSummary15,this.$FBRTCCallSummary17);break;case c('FBRTCConstants').PayloadType.OK:this.$FBRTCCallSummary36(i.RECV_OK);break;case c('FBRTCConstants').PayloadType.PRANSWER:this.$FBRTCCallSummary36(i.RECV_PRANSWER);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCCallSummary37(m,i.RECV_OFFER_ACK,i.RECV_RETRIED_OFFER_ACK);break;case c('FBRTCConstants').PayloadType.ANSWER_ACK:this.$FBRTCCallSummary37(m,i.RECV_ANSWER_ACK,i.RECV_RETRIED_ANSWER_ACK);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary38(l,this.$FBRTCCallSummary15,this.$FBRTCCallSummary17);break;default:}this.$FBRTCCallSummary26();};j.prototype.onMsgAckReceived=function(k,l){'use strict';var m=k.msg.flag===1;if(l){this.$FBRTCCallSummary37(m,i.RECV_OFFER_ACK,i.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummary37(m,i.RECV_ANSWER_ACK,i.RECV_RETRIED_ANSWER_ACK);};j.prototype.onNetworkReady=function(){'use strict';this.$FBRTCCallSummary36(i.NETWORK_READY);this.$FBRTCCallSummary26();};j.prototype.onCallConnected=function(){'use strict';this.$FBRTCCallSummary36(i.CALL_CONNECTED);this.$FBRTCCallSummary26();};j.prototype.onCallEnded=function(k,l,m,n){'use strict';this.$FBRTCCallSummary11=m;this.$FBRTCCallSummary6=k;this.$FBRTCCallSummary7=n;this.$FBRTCCallSummary8=l;this.$FBRTCCallSummary36(i.CALL_ENDED);this.$FBRTCCallSummary26();};j.prototype.setOfferSentTime=function(){'use strict';this.$FBRTCCallSummary36(i.SENT_OFFER);};j.prototype.setOfferAckReceivedTime=function(){'use strict';this.$FBRTCCallSummary36(i.RECV_OFFER_ACK);};j.prototype.setAnswerSentTime=function(){'use strict';this.$FBRTCCallSummary36(i.SENT_ANSWER);};j.prototype.setAnswerReceivedTime=function(){'use strict';this.$FBRTCCallSummary36(i.RECV_ANSWER);};j.prototype.toString=function(){'use strict';var k={};k.core_metrics=this.$FBRTCCallSummary41();k.time_series=null;return JSON.stringify(k);};j.prototype.$FBRTCCallSummary41=function(){'use strict';var k={};k.ver=j.CURRENT_SUMMARY_VERSION;k.log_level=c('FBRTCConstants').uploadLogLevelString(this.$FBRTCCallSummary2);k.caller=this.$FBRTCCallSummary1;k.call_type=this.$FBRTCCallSummary29;k.is_using_multiway=this.$FBRTCCallSummary30;k.conf_name=this.$FBRTCCallSummary31;k.serv_info=this.$FBRTCCallSummary32;k.conn=this.$FBRTCCallSummary42();k.peer_id=this.peerID;k.has_video=true;k.open_count=this.$FBRTCCallSummary23;k.signaling=this.$FBRTCCallSummary43();k.sender=this.$FBRTCCallSummary44();k.receiver=this.$FBRTCCallSummary45();k.end=this.$FBRTCCallSummary46();k.video=this.$FBRTCCallSummary47();k.push_phase=c('SiteData').push_phase;k.client_version=this.$FBRTCCallSummary18;return k;};j.prototype.$FBRTCCallSummary42=function(){'use strict';var k={dtls:1};if(this.$FBRTCCallSummary12.sender&&this.$FBRTCCallSummary12.sender.rtt)k.rtt=this.$FBRTCCallSummary12.sender.rtt;return k;};j.prototype.$FBRTCCallSummary43=function(){'use strict';var k={};if(this.$FBRTCCallSummary4)k.trigger=this.$FBRTCCallSummary4;k.start_time=this.$FBRTCCallSummary3;k.time_from_start=this.$FBRTCCallSummary5;var l=this.$FBRTCCallSummary5[i.CALL_CONNECTED],m=this.$FBRTCCallSummary5[i.CALL_ENDED];if(l){if(!m)if(this.$FBRTCCallSummary10){m=this.$FBRTCCallSummary10-this.$FBRTCCallSummary3;}else m=this.$FBRTCCallSummary48();var n=m-l;if(n>0)k.duration=n;}k.new_time_from_start=this.$FBRTCCallSummary21;l=this.$FBRTCCallSummary21[i.CALL_CONNECTED];m=this.$FBRTCCallSummary21[i.CALL_ENDED];if(l){if(!m)if(this.$FBRTCCallSummary20>0){m=this.$FBRTCCallSummary20;}else m=this.$FBRTCCallSummary35();n=m-l;if(n>0)k.new_duration=n;}return k;};j.prototype.$FBRTCCallSummary44=function(){'use strict';var k={};if(this.$FBRTCCallSummary14)k.ice_g0=this.$FBRTCCallSummary14;if(this.$FBRTCCallSummary16)k.ice=this.$FBRTCCallSummary16;if(this.$FBRTCCallSummary12.sender)Object.assign(k,this.$FBRTCCallSummary12.sender);return k;};j.prototype.$FBRTCCallSummary45=function(){'use strict';var k={};if(this.$FBRTCCallSummary15)k.ice_g0=this.$FBRTCCallSummary15;if(this.$FBRTCCallSummary17)k.ice=this.$FBRTCCallSummary17;return k;};j.prototype.$FBRTCCallSummary46=function(){'use strict';var k={};if(this.$FBRTCCallSummary6!==null){k.end_call_reason_string=c('FBRTCConstants').callEndReasonString(this.$FBRTCCallSummary6);if(this.$FBRTCCallSummary7!==null)k.end_call_subreason_string=this.$FBRTCCallSummary7;k.remote_ended=this.$FBRTCCallSummary8;}if(this.$FBRTCCallSummary12.end)Object.assign(k,this.$FBRTCCallSummary12.end);return k;};j.prototype.$FBRTCCallSummary47=function(){'use strict';var k={capture:{}};if(this.$FBRTCCallSummary12.video&&this.$FBRTCCallSummary12.video.sender)Object.assign(k,this.$FBRTCCallSummary12.video.sender);if(this.$FBRTCCallSummary13)Object.assign(k.capture,this.$FBRTCCallSummary13);return {sender:k,ld:this.$FBRTCCallSummary33,rd:this.$FBRTCCallSummary34};};j.prototype.$FBRTCCallSummary48=function(){'use strict';return new Date().valueOf()-this.$FBRTCCallSummary3;};j.prototype.$FBRTCCallSummary35=function(){'use strict';var k=c('performanceNow')()-this.$FBRTCCallSummary19;return Math.floor(this.$FBRTCCallSummary20+k);};j.prototype.$FBRTCCallSummary36=function(k){'use strict';if(this.$FBRTCCallSummary5[k])return;this.$FBRTCCallSummary5[k]=this.$FBRTCCallSummary48();this.$FBRTCCallSummary21[k]=this.$FBRTCCallSummary35();};j.prototype.$FBRTCCallSummary37=function(k,l,m){'use strict';if(k){this.$FBRTCCallSummary36(m);}else this.$FBRTCCallSummary36(l);};j.prototype.$FBRTCCallSummary26=function(){'use strict';this.$FBRTCCallSummary9=new Date().valueOf();};j.prototype.$FBRTCCallSummary25=function(){'use strict';return {device:c('UserAgentData').deviceName,os:c('UserAgentData').platformName,os_version:c('UserAgentData').platformFullVersion,browser:c('UserAgentData').browserName,browser_version:c('UserAgentData').browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};j.prototype.setClientVersion=function(k){'use strict';this.$FBRTCCallSummary18=k;};f.exports=j;}),null);
__d('FBRTCCallSummaryStore',['CacheStorage','FBRTCCallSummary','FBRTCLogger','areEqual'],(function a(b,c,d,e,f,g){var h='localstorage',i='RTC_CALL_SUMMARY_',j='summary',k=2000,l=3,m=3*60*1000,n=null;o.getInstance=function(){'use strict';if(!n)n=new o();return n;};function o(){'use strict';this.$FBRTCCallSummaryStore1=new (c('CacheStorage'))(h,i);this.$FBRTCCallSummaryStore2=c('FBRTCLogger').getInstance();}o.prototype.storeCallSummary=function(p,q,r){'use strict';var s=this;this.$FBRTCCallSummaryStore3(function(t){if(!t[p])t[p]={};var u=t[p][q];if(u){var v=s.$FBRTCCallSummaryStore4(u);if(v&&v.getLastUpdatedTime()>r.getLastUpdatedTime()){s.$FBRTCCallSummaryStore2.logToConsole('Outdated summaries');return null;}}t[p][q]=s.$FBRTCCallSummaryStore5(r);return t;},s.$FBRTCCallSummaryStore2.logError.bind(s.$FBRTCCallSummaryStore2,p,q));};o.prototype.retrieveCallSummary=function(p,q){'use strict';var r=this.$FBRTCCallSummaryStore6(),s=null;if(r[p])s=r[p][q];if(s){return this.$FBRTCCallSummaryStore4(s);}else return null;};o.prototype.removeCallSummary=function(p,q){'use strict';this.removeCallSummaries([{peerID:p,callID:q}]);};o.prototype.removeCallSummaries=function(p){'use strict';var q=this;this.$FBRTCCallSummaryStore3(function(r){var s=p.length;for(var t=0;t<s;t++){var u=p[t].peerID,v=p[t].callID;if(r[u]&&r[u][v]){delete r[u][v];if(q.$FBRTCCallSummaryStore7(r[u]))delete r[u];}}return r;},q.$FBRTCCallSummaryStore2.logError.bind(q.$FBRTCCallSummaryStore2,null,null));};o.prototype.getLoggableSummaries=function(){'use strict';var p=this.$FBRTCCallSummaryStore6(),q=[];for(var r in p)if(Object.prototype.hasOwnProperty.call(p,r))for(var s in p[r])if(Object.prototype.hasOwnProperty.call(p[r],s)){var t=this.$FBRTCCallSummaryStore4(p[r][s],m);if(t)q.push(t);}return q;};o.prototype.$FBRTCCallSummaryStore7=function(p){'use strict';for(var q in p)if(Object.prototype.hasOwnProperty.call(p,q))return false;return true;};o.prototype.$FBRTCCallSummaryStore5=function(p){'use strict';var q={__t:Date.now(),__d:p.toJsonString()};return q;};o.prototype.$FBRTCCallSummaryStore4=function(p,q){'use strict';if(p)if(!q||Date.now()-p.__t>=q)return c('FBRTCCallSummary').fromJsonString(p.__d);return null;};o.prototype.$FBRTCCallSummaryStore6=function(){'use strict';var p=this.$FBRTCCallSummaryStore1.get(j)||{};return p;};o.prototype.$FBRTCCallSummaryStore3=function(p,q,r,s){'use strict';if(r===undefined||r===null)r=l;var t=this.$FBRTCCallSummaryStore6(),u=this.$FBRTCCallSummaryStore6(),v=p(t);if(v===null)return;var w=this.$FBRTCCallSummaryStore6();if(c('areEqual')(u,w)){this.$FBRTCCallSummaryStore1.set(j,v);this.$FBRTCCallSummaryStore2.logToConsole('Updated summaries');}else if(r>0){q('Retry lock');if(s){var x=this;setTimeout(function(){x.$FBRTCCallSummaryStore3(p,q,r-1,true);},k);}else this.$FBRTCCallSummaryStore3(p,q,r-1,true);}else q('Failed to lock');};f.exports=o;}),null);
__d("XGroupCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/{?conference_name}\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:true},server_info_data:{type:"String"},nonce:{type:"String"}});}),null);
__d("XGroupCallSigningController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/init\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}});}),null);
__d("XVideoCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}});}),null);
__d("XVideoCallInitController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});}),null);
__d("XWirelessScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/screen_sharing\/{?session_id}\/",{nonce:{type:"String"},peer_id:{type:"FBID",required:true},session_id:{type:"Int"}});}),null);
__d('FBRTCUrlManager',['regeneratorRuntime','Promise','CurrentUser','FBRTCConfig','FBRTCLogger','FBRTCUtils','URI','XGroupCallController','XGroupCallSigningController','XVideoCallController','XVideoCallInitController','XWirelessScreenSharingController'],(function a(b,c,d,e,f,g){var h=3,i=function p(q,r,s,t){c('FBRTCLogger').getInstance().logCallAction(q,r,c('FBRTCLogger').CallAction.OLD_URI);return c('XVideoCallController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).getURI();},j=function p(q,r,s,t,u,v){var w=arguments.length<=6||arguments[6]===undefined?h:arguments[6],x=arguments.length<=7||arguments[7]===undefined?'':arguments[7];if(w===undefined||w===null)w=h;var y=c('XVideoCallInitController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).getURI();y=c('FBRTCUtils').isPeerVCEndpoint(q)||x==='quickdial'?k(y):y;c('FBRTCUtils').sendServerRequest(y,function(z){u(z.payload.uri);},function(z){if(w>0){p(q,r,s,t,u,v,w-1,x);}else u(i(q,r,s,t));});};function k(p){if(c('CurrentUser').isEmployee()){p=p.setSubdomain(c('CurrentUser').hasWorkUser()||c('CurrentUser').isWorkUser()?'fb':'www');var q='/intern/';return c('URI').getRequestURI().getPath().substr(0,q.length)!==q?p:p.setDomain(p.getDomain().toString().replace(/.(intern|cstools)./,'.'));}return p;}function l(p){var q=p.conferenceName,r=p.callID,s=p.usersToRing,t=p.hasVideo,u=p.nonce,v=p.serverInfoData,w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:w=c('XGroupCallSigningController').getURIBuilder().setString('conference_name',q).setInt('call_id',r).setFBIDSet('users_to_ring',s).setBool('has_video',t).setString('server_info_data',v).setString('nonce',u).getURI();return y.abrupt('return',new (c('Promise'))(function(z,aa){c('FBRTCUtils').sendServerRequest(w,function(ba){z(ba.payload.uri);},function(ba){aa(ba);});}));case 2:case 'end':return y.stop();}},null,this);}var m=function p(q,r,s,t,u,v,w){if(w===undefined||w===null)w=h;var x=c('XGroupCallSigningController').getURIBuilder().setFBID('call_id',q).setBool('is_caller',s).setBool('audio_only',t).setFBIDSet('users_to_ring',r).getURI();c('FBRTCUtils').sendServerRequest(x,function(y){u(y.payload.uri);},function(y){if(w>0){p(q,r,s,t,u,v,w-1);}else{var z=c('XGroupCallController').getURIBuilder().setFBID('call_id',q).setBool('is_caller',s).setBool('audio_only',t).setFBIDSet('users_to_ring',r).getURI();u(z);}});},n=function p(q){if(c('FBRTCConfig').disableURLManager())return;window.history.replaceState({},'',q);},o={init:function p(q){this._peerID=q;},onCallStarted:function p(){n(i(this._peerID));},getCallUri:j,getGroupCallUri:function p(q,r,s,t,u,v){var w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:w=0;case 1:if(!(w<3)){y.next=14;break;}y.prev=2;y.next=5;return c('regeneratorRuntime').awrap(l({conferenceName:q,callID:r,usersToRing:s,hasVideo:t,nonce:u,serverInfoData:v}));case 5:return y.abrupt('return',y.sent);case 8:y.prev=8;y.t0=y['catch'](2);case 11:w++;y.next=1;break;case 14:return y.abrupt('return',c('XGroupCallController').getURIBuilder().setString('conference_name',q).setInt('call_id',r).setFBIDSet('users_to_ring',s).setBool('has_video',t).setString('server_info_data',v).setString('nonce',u).getURI());case 15:case 'end':return y.stop();}},null,this,[[2,8]]);},getNonceUri:function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?'':arguments[5],w=c('XVideoCallController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).setString('nonce',u).getURI();return c('FBRTCUtils').isPeerVCEndpoint(q)||v==='quickdial'?k(w):w;},getWirelessScreenSharingUri:function p(q,r,s){var t=c('XWirelessScreenSharingController').getURIBuilder().setFBID('peer_id',r).setInt('session_id',s).setString('nonce',q).getURI();return k(t);}};f.exports=o;}),null);
__d('FBRTCCallUI',['regeneratorRuntime','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConstants','FBRTCLogger','FBRTCMessageListener','FBRTCUrlManager','VideoCallTypedLogger','pageID'],(function a(b,c,d,e,f,g){var h={openGroupCallUI:function i(j,k,l,m,n,o,p){var q,r;return c('regeneratorRuntime').async(function s(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return c('regeneratorRuntime').awrap(c('FBRTCUrlManager').getGroupCallUri(j,k,l,m,c('FBRTCMessageListener').generateNewNonce(),p));case 2:q=t.sent;o.location=q;o.focus&&o.focus();r=new (c('FBRTCCallSummary'))({peerID:-1,callID:k,isCaller:true});r.onCallStarted(n);r.addExtraInfo(c('FBRTCLogger').Key.INITIATED_BY_PAGE_ID,c('pageID'));r.onCallEnded(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,'PopupPending');r.save(c('FBRTCCallSummaryStore').getInstance());case 10:case 'end':return t.stop();}},null,this);},openGroupCallURI:function i(j){var k=j.conferenceName,l=j.callID,m=j.hasVideo,n=j.serverInfoData,o=j.trigger,p=j.callSummary,q=j.callWindow,r;return c('regeneratorRuntime').async(function s(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return c('regeneratorRuntime').awrap(c('FBRTCUrlManager').getGroupCallUri(k,l,[],m,c('FBRTCMessageListener').generateNewNonce(),n));case 2:r=t.sent;q.location=r;q.focus&&q.focus();p.onCallStarted(o);p.addExtraInfo(c('FBRTCLogger').Key.INITIATED_BY_PAGE_ID,c('pageID'));p.onCallEnded(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,'PopupPending');p.save(c('FBRTCCallSummaryStore').getInstance());case 9:case 'end':return t.stop();}},null,this);},openAsCaller:function i(j,k,l,m,n){new (c('VideoCallTypedLogger'))().setEvent('open_as_caller').log();c('FBRTCLogger').getInstance().logCallAction(j,k,c('FBRTCLogger').CallAction.START_CALL,null,l);var o=new (c('FBRTCCallSummary'))({peerID:j,callID:k,isCaller:true});o.onCallStarted(l);this._open(j,k,true,o,false,m,n,l);},openAsCallee:function i(j,k,l,m,n,o){new (c('VideoCallTypedLogger'))().setEvent('open_as_callee').log();this._open(j,k,false,l,m,n,o);},_open:function i(j,k,l,m,n,o,p){var q=arguments.length<=7||arguments[7]===undefined?'':arguments[7];m.addExtraInfo(c('FBRTCLogger').Key.INITIATED_BY_PAGE_ID,c('pageID'));m.onCallEnded(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,'PopupPending');m.save(c('FBRTCCallSummaryStore').getInstance());if(!p)return;n=c('FBRTCUrlManager').getNonceUri(j,k,l,o,c('FBRTCMessageListener').generateNewNonce(),q);new (c('VideoCallTypedLogger'))().setEvent('open_popup').log();if(!n){this._setUri(p,j,k,l,o);}else{c('FBRTCLogger').getInstance().logCallAction(j,k,c('FBRTCLogger').CallAction.OPEN_POPUP);p.location=n;}p.focus&&p.focus();},_setUri:function i(j,k,l,m,n){c('FBRTCUrlManager').getCallUri(k,l,m,n,function(o){c('FBRTCLogger').getInstance().logCallAction(k,l,c('FBRTCLogger').CallAction.OPEN_POPUP);j.location=o;},function(){c('FBRTCLogger').getInstance().logCallAction(k,l,c('FBRTCLogger').CallAction.FAILED_GETTING_URI);});}};f.exports=h;}),null);
__d('FBRTCSdpUtils',['UserAgent'],(function a(b,c,d,e,f,g){var h='m=video 0',i='m=video 0 NULL/NULL 0',j=function n(o){return o.match(/^a=rtpmap:(\d+)\s/)[1];},k=function n(o,p,q){var r=j(o[p]),s=o[q].split('RTP/SAVPF'),t=s[1].split(/\s+/),u=t.indexOf(r);t.splice(u,1);s[1]=t.join(' ');o[q]=s.join('RTP/SAVPF');o.splice(p,1);},l=function n(o,p,q){var r=j(o[p]);k(o,p,q);var s=new RegExp('^a=(rtcp-fb|fmtp):'+r+' ');o=o.filter(function(w){return !s.test(w);});var t=new RegExp('^a=fmtp:(\\d+)\\s+apt='+r+'($|;)'),u=o.reduce(function(w,x,y){var z=x.match(t);return z?[].concat(w,[z[1]]):w;},[]).join('|'),v=new RegExp('^a=rtpmap:('+u+')\\s+rtx/|^a=fmtp:('+u+')\\s+apt=');return o.filter(function(w){return !v.test(w);});},m={replaceRTPSAVPFProfile:function n(o){var p='UDP/TLS/RTP/SAVPF',q='RTP/SAVPF';while(o.indexOf(p)>=0)o=o.replace(p,q);return o;},addIceOptionToSdp:function n(o,p){"use strict";var q="a=ice-options:",r=o.indexOf(q);if(r>=0){var s=o.indexOf("\r",r);return [o.slice(0,s)," ",p,o.slice(s)].join('');}var t=q+p,u=o.split("\r\n"),v=false,w=-1;for(var x=0;x<u.length;x++){var y=u[x].slice(0,2);if(y=="s="){v=true;continue;}if(v&&y=="a="){w=x;break;}}if(w>=0){u.splice(w,0,t);return u.join("\r\n");}return [o,t,"\r\n"].join('');},preferIsac:function n(o){var p=o.split("\r\n"),q=-1,r=-1,s=-1;for(var t=0;t<p.length;t++){var u=p[t];if(u.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))q=t;if(s===-1&&q>-1&&u.match(/^a=rtpmap:/))s=t;if(u.match(/^a=rtpmap:\d+\s+ISAC\/16000/))r=t;}if(q===-1||r===-1||s===-1)return p.join("\r\n");var v=p[r];k(p,r,q);p.splice(s,0,v);p[q]=p[q].replace('RTP/SAVPF','RTP/SAVPF '+j(v));return p.join("\r\n");},preferCodec:function n(o,p,q){var r=o.split('\r\n'),s=new RegExp('m='+(q?'video':'audio')+'\\s+\\d+\\s+RTP/SAVPF(\\s+\\d+)+'),t=r.findIndex(function(z){return s.test(z);}),u=new RegExp('^a=rtpmap:\\d+\\s+'+p),v=r.findIndex(function(z){return u.test(z);}),w=/^a=rtpmap:/,x=r.findIndex(function(z,aa){return aa>t&&w.test(z);});if(t!==-1&&v!==-1&&x!==-1){var y=r[v];k(r,v,t);r.splice(x,0,y);r[t]=r[t].replace('RTP/SAVPF','RTP/SAVPF '+j(y));}return r.join('\r\n');},disableVideo:function n(o){var p=/m=video\s+\S+/;o=o.replace(p,h);if(c('UserAgent').isBrowser('Firefox <= 37'))o=this._makeDisabledVideoReceiveOnly(o);return o;},_makeDisabledVideoReceiveOnly:function n(o){if(o.indexOf(h)>-1){var p=o.split(h);p[1]=p[1].replace(/send(recv|only)/,'recvonly');o=p.join(h);}return o;},fixMobileIceSdp:function n(o){o=o.replace(/^a=/,'');o=o.split(/\s+username\s+.+password.+/)[0];var p=o.match(/\s+relay\s+|\s+srflx\s+/),q=o.match(/raddr.+rport.+/);if(p&&!q){p=p[0];var r=o.split(p),s=r[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),t=void 0,u=void 0;if(s){t=s[1];u=s[2];r[1]=r[1].replace(s[0],'');}else{s=r[0].split(/\s+/);t=s[4];u=s[5];}o=''+r[0]+p+'raddr '+t+' rport '+u+' '+r[1];}return o;},addAudioNack:function n(o){var p=[];o=o.split('\r\n').map(function(q){var r='';if(p.length>0&&(/^a=rtpmap:(\d+)/.test(q)||/^a=ssrc/.test(q)||/^m=/.test(q))){r+=this._getrtcpFeedbackLinesFromAudioFMTs(p)+'\r\n';p=[];}if(/^m=audio/.test(q))p=q.match(/^m=audio\s+[\d\/]+\s+[\w\/]+([\s+\d+]+)/)[1].trim().split(' ');return r+q;}.bind(this)).join('\r\n');if(p.length>0)o+='\r\n'+this._getrtcpFeedbackLinesFromAudioFMTs(p);return o;},_getrtcpFeedbackLinesFromAudioFMTs:function n(o){return o.map(function(p){return 'a=rtcp-fb:'+p+' nack';}).join('\r\n');},removeFEC:function n(o){var p=o.split('\r\n'),q=void 0,r=void 0;for(var s=0;s<p.length;s++){if(p[s].match(/^a=rtpmap:\d+\s+red\//))q=s;if(p[s].match(/^m=video/))r=s;}if(q&&r)k(p,q,r);return p.join('\r\n');},removeH264:function n(o){var p=o.split('\r\n'),q=/^a=rtpmap:\d+\s+H264\//,r=p.findIndex(function(u){return q.test(u);}),s=/^m=video/,t=p.findIndex(function(u){return s.test(u);});return r!==-1&&t!==-1?l(p,r,t).join('\r\n'):o;},removeVP9:function n(o){var p=o.split('\r\n'),q=/^a=rtpmap:\d+\s+VP9\//,r=p.findIndex(function(u){return q.test(u);}),s=/^m=video/,t=p.findIndex(function(u){return s.test(u);});return r!==-1&&t!==-1?l(p,r,t).join('\r\n'):o;},isVideoSupported:function n(o){return o&&o.indexOf('m=video')!==-1&&(o.indexOf(h)===-1||o.indexOf(i)!==-1);},setDtlsRole:function n(o,p){if(!o.match(/setup:(active|passive|actpass)/)){return o.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+p);}else return o.replace(/setup:actpass/g,'setup:'+p);},setVideoBitrateConstraint:function n(o){var p=720;if(o.match(/^b=AS:/m))return o;o=o.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+p+'\r\n');return o;},removeSdparta:function n(o){var p=o.split('\r\n'),q='audio',r=false,s=-1;for(var t=0;t<p.length;t++){var u=p[t];if(u.indexOf('m=audio')===0)q='audio';if(u.indexOf('m=video')===0){r=true;q='video';}if(u.indexOf('a=mid:sdparta_')===0)p[t]='a=mid:'+q;if(u.indexOf('a=group:BUNDLE sdparta_')===0)s=t;}if(s>-1)if(r){p[s]='a=group:BUNDLE audio video';}else p[s]='a=group:BUNDLE audio';return p.join('\r\n');},useDTLSOverCrypto:function n(o){if(!(c('UserAgent').isBrowser('Chrome >= 57')||c('UserAgent').isBrowser('Opera >= 44')))return o;if(!/^a=fingerprint:/m.test(o))return o;return o.split('\r\n').filter(function(p){return p.indexOf('a=crypto:')!==0;}).join('\r\n');},validateOfferSdp:function n(o,p){var q;if(o.split(':')[0]==='LIVE'){var q=function(){var r=/^m=/,s=/^m=audio/,t=/^m=video/,u=/^a=ssrc:/,v=p.split('\r\n'),w=[];for(var x=v.length-1;x>=0;x--)if(r.test(v[x]))w.push(v.splice(x));var y=false,z=false;w.forEach(function(aa){if(s.test(aa[0])&&!y){y=aa.some(function(ba){return u.test(ba);});}else if(t.test(aa[0])&&!z)z=aa.some(function(ba){return u.test(ba);});});return {v:y&&z};}();if(typeof q==="object")return q.v;}return true;},addNullVideo:function n(o){if(o.indexOf('m=video')!==-1)return o;if(o.indexOf('m=audio')===-1)return o+'\r\n'+i;var p=o.split('\r\n'),q=-1;for(var r=0;r<p.length;r++){var s=p[r];if(q>-1){if(!/^[abcik]=/.test(s))break;q=r;}else if(s.indexOf('m=audio')===0)q=r;}p.splice(q+1,0,i);return p.join('\r\n');},hasNullVideo:function n(o){return o.indexOf(i)!==-1;}};f.exports=m;}),null);
__d('SoundPlayer',['Map','URI','createArrayFromMixed'],(function a(b,c,d,e,f,g){'use strict';var h=new (c('Map'))();function i(l){var m=new (c('URI'))(l);return m.getDomain()?l:new (c('URI'))(window.location.href).setPath(m.getPath()).toString();}function j(l){var m=new (c('URI'))(l).getPath();if(/\.mp3$/.test(m))return 'audio/mpeg';if(/\.og[ga]$/.test(m))return 'audio/ogg';return '';}var k={preload:function l(m){for(var n=c('createArrayFromMixed')(m),o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(h.has(r))return;var s=document.createElement('audio');if(!s||!s.canPlayType||!s.canPlayType(j(r)))continue;s.preload='auto';s.src=i(r);document.body&&document.body.appendChild(s);h.set(r,s);return;}},play:function l(m){var n=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];for(var o=c('createArrayFromMixed')(m),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r;if(!h.has(s))k.preload(s);var t=h.get(s);if(!t)continue;if(n.loop)t.setAttribute('loop','');if(n.volume)t.volume=n.volume;t.play();return;}},pause:function l(m){for(var n=c('createArrayFromMixed')(m),o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q,s=h.get(r);if(s){s.pause();return;}}},stop:function l(m){for(var n=c('createArrayFromMixed')(m),o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q,s=h.get(r);if(s){s.pause();s.removeAttribute('src');s.src=i(r);return;}}}};f.exports=k;}),null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],(function a(b,c,d,e,f,g){var h='fb_sounds_playing3';function i(){var m=c('WebStorage').getLocalStorage();if(m)try{var n=m[h];if(n){n=JSON.parse(n);if(Array.isArray(n))return n;}}catch(o){}return [];}function j(m){var n=c('WebStorage').getLocalStorage();if(n){var o=i();o.push(m);while(o.length>5)o.shift();try{n[h]=JSON.stringify(o);}catch(p){}}}function k(m){return i().some(function(n){return n===m;});}var l={play:function m(n,o,p){n=c('createArrayFromMixed')(n);o=o||n[0]+Math.floor(Date.now()/1000);if(k(o))return;c('SoundPlayer').play(n,{loop:!!p});j(o);},isSupported:function m(){return !!c('WebStorage').getLocalStorage();}};f.exports=l;}),null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],(function a(b,c,d,e,f,g){function h(j,k,l){c('SoundSynchronizer').play(j,k,l);}var i={playLocal:h,playRemote:function j(k,l,m,n){var o={name:'SoundRPC',data:{paths:l,sync:m,loop:n}};k.postMessage(c('FBJSON').stringify(o),'*');},supportsRPC:function j(){return !!window.postMessage;},_listen:function j(){c('Event').listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l={};try{l=c('FBJSON').parse(k.data);}catch(m){}if(l.name==='SoundRPC')h(l.data.paths,l.data.sync,l.data.loop);});}};f.exports=i;}),null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],(function a(b,c,d,e,f,g){var h=null,i=false,j={init:function n(o){},play:function n(o,p,q){if(h){c('SoundRPC').playRemote(h.contentWindow,o,p,false);}else c('SoundRPC').playLocal(o,p,q);i=true;},hasPlayedSoundBefore:function n(){return i;},playOnlyIfImmediate:function n(o,p,q){if(!i&&c('Visibility').isHidden())return;this.play(o,p,q);},stop:function n(o){if(!h)c('SoundPlayer').stop(o);}},k=new (c('URI'))(location.href);if(k.getSubdomain()&&k.getSubdomain()!=='www')k.setSubdomain('www');var l=k.getDomain();function m(){if(c('UserAgent_DEPRECATED').ie()<9)return false;if(c('SoundInitialData').RPC_DISABLED)return false;return c('SoundSynchronizer').isSupported()&&c('SoundRPC').supportsRPC();}if(c('isFacebookURI')(k)&&location.host!==l&&m()){h=document.createElement('iframe');h.setAttribute('src','//'+l+'/sound_iframe.php');h.style.display='none';document.body.appendChild(h);}f.exports=j;}),null);
__d('FBRTCSoundController',['RTCConfig','Sound'],(function a(b,c,d,e,f,g){var h=[c('RTCConfig').ringtone_mp3_url,c('RTCConfig').ringtone_ogg_url],i={playIncomingRingtone:function j(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');c('Sound').play(h,n,m);},stopIncomingRingtone:function j(){c('Sound').stop(h);}};f.exports=i;}),null);
__d('QE',['Banzai','Cache'],(function a(b,c,d,e,f,g){var h='qe_log_exposure',i=60,j=new (c('Cache'))(),k={logExposure:function l(m,n){var o=n?m+'|'+n:m;if(j.has(o))return;var p={signal:true},q={name:m,id:null};if(n)q.id=n;c('Banzai').post(h,q,p);j.set(o,true,1,i);}};f.exports=k;}),null);
__d('FBRTCExperiment',['FBRTCExperimentsConfig','QE'],(function a(b,c,d,e,f,g){'use strict';h.gen=function(i){var j={params:{},in_experiment:false,auto_exposure:false},k=c('FBRTCExperimentsConfig')[i]||j,l=new h(i,k.params,k.in_experiment);if(k.auto_exposure)l.logExposure(i);return l;};function h(i,j,k){this.$FBRTCExperiment2=i;this.$FBRTCExperiment3=j;this.$FBRTCExperiment1=k;}h.prototype.logExposure=function(){if(this.$FBRTCExperiment1)c('QE').logExposure(this.$FBRTCExperiment2);};h.prototype.getParam=function(i,j){if(this.$FBRTCExperiment3[i])return this.$FBRTCExperiment3[i].toString();return j;};h.prototype.getInt=function(i,j){if(this.$FBRTCExperiment3[i])return parseInt(this.$FBRTCExperiment3[i],10);return j;};h.prototype.getBool=function(i,j){var k=this.$FBRTCExperiment3;if(k[i])return k[i]==='1'||k[i]===1||k[i]==='true';return j;};f.exports=h;}),null);
__d('BanzaiScribe',['Banzai'],(function a(b,c,d,e,f,g){function h(j){return {log:function k(l,m,n){var o=[m];if(n!=null)o.push(n);c('Banzai').post('scribe:'+l,o,j);}};}var i=h({});i.create=h;f.exports=i;}),null);
__d('SamplingPolicyBase',[],(function a(b,c,d,e,f,g){function h(){'use strict';throw new Error('Tried to instantiate SamplingPolicyBase');}h.prototype.getName=function(){'use strict';return this.name;};h.prototype.isSampled=function(){'use strict';if(typeof this.sampled=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};f.exports=h;}),null);
__d('FbtraceForcedByServerPolicy',['FbtraceForcedByServer','SamplingPolicyBase'],(function a(b,c,d,e,f,g){'use strict';var h=void 0;function i(){this.name='FbtraceForcedByServerPolicy';}i.get=function(){if(typeof h=='undefined')h=new i();return h;};function j(){return c('FbtraceForcedByServer').forced;}Object.assign(i.prototype,c('SamplingPolicyBase').prototype,{decideIfSampled:j});f.exports=i;}),null);
__d("guardFunction",[],(function a(b,c,d,e,f,g){function h(i,j,k){return function(){if(i.apply(k||this,arguments))j.apply(k||this,arguments);};}f.exports=h;}),null);
__d('Fbtrace',['Arbiter','ArtilleryTraceIDUtils','BanzaiScribe','FbtraceForcedByServer','FbtraceForcedByServerPolicy','SiteData','guardFunction'],(function a(b,c,d,e,f,g){'use strict';function h(){Object.assign(this,h);}Object.assign(h,{isOn:function s(){return false;},replySend:function s(t,u){},requestSend:function s(t,u,v){m(t,u);return {metadata:function w(){return undefined;},replyReceive:function w(x){}};}});var i=new h();function j(s,t,u){if(!s)throw {name:'ArgumentError',message:'no valid service name specified'};if(!t)throw {name:'ArgumentError',message:'no valid version specified'};var v=c('BanzaiScribe'),w=0,x=c('ArtilleryTraceIDUtils').newTraceId(),y=c('ArtilleryTraceIDUtils').newObjectId(),z=c('ArtilleryTraceIDUtils').traceIdToBucket(x),aa={service:s,version:t},ba=function ga(ha){if(typeof ha=='undefined')return 'undefined';if(typeof ha!='string')ha=ga(JSON.stringify(ha));return ha;},ca=function ga(ha){var ia='';for(var ja in ha){if(ia.length>0)ia+='\x02';ia+=ba(ja)+'\x03'+ba(ha[ja]);}return ia;},da=function ga(ha,ia,event,ja,ka){w++;return [ka,w,x,ha,ia,ba(event),ca(ja)].join('\x01');},ea=function ga(ha,ia,event,ja,ka){if(!ka&&typeof ka=='undefined')ka=Date.now()*1000;var la=da(ha,ia,event,ja,ka);v.log('fbtrace',la,z);},fa=function ga(){return y;};ea(c('ArtilleryTraceIDUtils').getDummyId(),y,'#rqrecv',Object.assign(u||{},aa));Object.assign(this,j,{replySend:function ga(ha,ia){ia=babelHelpers['extends']({},ia,aa,{success:ha?'true':'false'});ea(c('ArtilleryTraceIDUtils').getDummyId(),y,'#rpsend',ia);},requestSend:function ga(ha,ia,ja){m(ha,ia);var ka=fa(),la=c('ArtilleryTraceIDUtils').newObjectId();ja=babelHelpers['extends']({},ja,aa,{op:ha,'remote:service':ia});ea(ka,la,'#rqsend',ja);return {metadata:function ma(){return x+la;},replyReceive:function ma(na){ea(ka,la,'#rprecv',Object.assign(na||{},aa));},parentNode:this};}});}Object.assign(j,{isOn:function s(){return true;}});function k(){return i;}function l(s,t,u){u=u||{};u.init=true;var v=c('FbtraceForcedByServerPolicy').get();if(v.isSampled()){return new j(s,t,u);}else return new h();}function m(s,t){if(!s)throw {name:'ArgumentError',message:'no valid operation specified'};if(!t)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function n(s,t){var u=i,v=void 0;i=s;try{v=t();}finally{i=u;}return v;}var o=function s(t,u){var v=k(),w=u.request,x=false;if(!v.isOn()&&c('FbtraceForcedByServer').forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(w.uri.toString())){v=l('photo_upload_kludge',String(c('SiteData').client_revision||'dev'),{policy:'PhotoUpload'});x=true;}if(v.isOn()){var y=x?{policy:'PhotoUpload'}:{};if(w.userActionId)y.user_action_id=w.userActionId;var z=v.requestSend(w.uri.toString(),'www',y);w.fbtraceRemoteNode=z;w.transport.setRequestHeader('X-Fbtrace-Meta',z.metadata());}},p=function s(t,u){u.request.fbtraceRemoteNode.replyReceive({is_last:u.response.is_last,success:true});setTimeout(function(){u.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},q=function s(t,u){u.request.fbtraceRemoteNode.replyReceive({is_last:u.response.is_last,success:false,error_code:u.response.error,error_summary:u.response.errorSummary,error_description:u.response.errorDescription});setTimeout(function(){u.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},r=function s(t,u){return u.request.fbtraceRemoteNode;};c('Arbiter').subscribe('AsyncRequest/will_send',o);c('Arbiter').subscribe('AsyncRequest/response',c('guardFunction')(r,p));c('Arbiter').subscribe('AsyncRequest/error',c('guardFunction')(r,q));f.exports={defaultNode:k,requestReceive:l,withDefaultNode:n};}),null);