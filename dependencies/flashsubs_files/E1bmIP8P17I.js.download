if (self.CavalryLogger) { CavalryLogger.start_js(["xQEbk"]); }

__d('TypingDetectorController',['AsyncRequest','AvailableList','AvailableListConstants','ChatVisibility','Keys','MercuryServerRequestsConfig','TypingDetector','TypingStates','emptyFunction','ifRequired','setTimeoutAcrossTransitions','shield'],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k,l,m,n){this.userID=i;this.input=j;this.source=k;this.threadID=m;this.remoteState=c('TypingStates').INACTIVE;this.notifyTimer=null;l=l||{};this.notifyDelay=l.notifyDelay||this.notifyDelay;this._typingDetector=new (c('TypingDetector'))(j,n);this._typingDetector.init(l);this._typingDetector.subscribe('change',this._stateChange.bind(this));}h.prototype.setUserAndThread=function(i,j){if(this.userID!==i||this.threadID!==j){this.resetState();this.userID=i;this.threadID=j;}};h.prototype.setIgnoreEnter=function(i){var j=i?[c('Keys').RETURN]:[];this._typingDetector.setIgnoreKeys(j);};h.prototype.resetState=function(){this._notifyState(c('TypingStates').INACTIVE);this.remoteState=c('TypingStates').INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};h.prototype.destroy=function(){this.resetState();this._typingDetector.destroy();};h.prototype._stateChange=function(i,j){if(j!=c('TypingStates').QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=c('setTimeoutAcrossTransitions')(c('shield')(this._notifyState,this,j),this.notifyDelay);}else this._notifyState(j,true);};h.prototype._notifyState=function(i,j){if(!this.userID&&!this.threadID||!c('ChatVisibility').isOnline()||i===this.remoteState||c('ifRequired')('ChannelConnection',function(k){return k.disconnected();},function(){return true;}))return;this._sendRequest(i,this.userID,j);};h.prototype._sendRequest=function(i,j,k){this.remoteState=i;var l={typ:i,to:j,source:this.source,thread:this.threadID},m=new (c('AsyncRequest'))().setHandler(this._onTypResponse.bind(this,j)).setErrorHandler(c('emptyFunction')).setData(l).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous_DEPRECATED',!k);if(c('MercuryServerRequestsConfig').msgrRegion)m.setRequestHeader('X-MSGR-Region',c('MercuryServerRequestsConfig').msgrRegion);m.send();};h.prototype._onTypResponse=function(i,j){var k=j.getPayload()||{};if(k.offline)c('AvailableList').set(i,c('AvailableListConstants').OFFLINE,'typing_response');};Object.assign(h.prototype,{notifyDelay:1000});f.exports=h;}),null);