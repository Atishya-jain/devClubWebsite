if (self.CavalryLogger) { CavalryLogger.start_js(["qEMau"]); }

__d('MessengerComposerContainer.react',['fbt','Arbiter','AsyncUploadRequest','EmojiLikeUtils','EmojiState','EmojiDispatcher','immutable','MercuryAttachment','MercuryAttachmentType','MercuryConfig','MercuryThreadIDMap','MercuryThreadInformer','MercuryIDs','MercuryLocalIDs','MercuryMessageActions','MercuryMessageObject','MercuryParticipants','MercurySendMessageHandler','MercuryThreads','MercuryThreadActions','MercuryTriodeSourceUtil','MessageRequestUtils','MessengerActions','MessengerComposer.react','MessengerComposerActions','messengerDialogsRe','MessengerEmojiUsageUtils','messengerSimpleDialogReact','MessengerView','MNPlatformTagsDataManager','PhotosUploadID','React','ReactDOM','SearchableEntry','SubscriptionsHandler','setImmediate','EmojiStateStore'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('messengerSimpleDialogReact').jsComponent,l=c('React').PropTypes;i=babelHelpers.inherits(m,c('React').PureComponent);j=i&&i.prototype;function m(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=j.constructor).call.apply(o,[this].concat(r)),this.$MessengerComposerContainer8=function(t,u,v){c('EmojiState').updateRecentlyUsed(c('MessengerEmojiUsageUtils').findAllEmojis(t));if(!this.props.canReply){v&&v(null);return false;}var w=null,x=false;if(!this.$MessengerComposerContainer16(t,u))x=this.$MessengerComposerContainer17(function(y){var z=this.$MessengerComposerContainer2.constructUserGeneratedMessageObject(t,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),y),aa=c('MercuryIDs').getUserIDFromThreadID(y);if(c('MNPlatformTagsDataManager').hasThreadTags(aa)){var ba=c('MNPlatformTagsDataManager').getThreadTags();z.tags=ba;}if(u){if(u.shareable_attachment)z.shareable_attachment=u.shareable_attachment;if(u.profile_ranges)z.profile_ranges=z.profile_xmd=u.profile_ranges;}w=z;return z;}.bind(this));v&&v(x?w:null);w=null;return x;}.bind(this),this.$MessengerComposerContainer10=function(t,u){this.$MessengerComposerContainer3.cancelAttachmentPlaceholder(u.upload_id,u);}.bind(this),this.$MessengerComposerContainer9=function(t,u){this.$MessengerComposerContainer3.confirmAttachmentPlaceholder(u.upload_id,u);}.bind(this),this.$MessengerComposerContainer11=function(t,u){this.$MessengerComposerContainer3.cancelAttachmentPlaceholder(u.upload_id,u);var v=h._("Photo Upload failed"),w=h._("Please try again. Make sure you are uploading a valid photo.");if(u.errorDialogParams){v=u.errorDialogParams.title||v;w=u.errorDialogParams.body||w;}this.$MessengerComposerContainer18(v,w);}.bind(this),this.$MessengerComposerContainer12=function(t,u){this.$MessengerComposerContainer17(function(v){return this.$MessengerComposerContainer2.constructAttachmentMessageObject(c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),v);}.bind(this),function(v){this.$MessengerComposerContainer3.addAttachmentPlaceholder(v,u.upload_id,u);this.handleMessageSentToPendingThread();}.bind(this));}.bind(this),this.$MessengerComposerContainer15=function(t){var u='upload_'+c('PhotosUploadID').getNewID();this.$MessengerComposerContainer1.sendAttachment(this.props.threadID,n(u),c('MercuryTriodeSourceUtil').getMercuryTriodeSource());var v={};v[u]=t;var w=new (c('AsyncUploadRequest'))(c('MercuryConfig').upload_url).setAllowCrossOrigin(true).setRelativeTo(c('ReactDOM').findDOMNode(this)).setData({voice_clip:true}).setFiles(v);this.$MessengerComposerContainer4.addSubscriptions(w.subscribe('success',function(x,y){return this.$MessengerComposerContainer19(y);}.bind(this)));w.send();}.bind(this),this.$MessengerComposerContainer19=function(t){var u=t.getName(),v=t.getResponse().payload.metadata[0].audio_id;this.$MessengerComposerContainer3.confirmAttachmentPlaceholder(u,{upload_id:u,audio_ids:[v]});}.bind(this),this.$MessengerComposerContainer13=function(t){return this.$MessengerComposerContainer17(function(u){return this.$MessengerComposerContainer2.constructStickerMessageObject(t,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),u);}.bind(this));}.bind(this),this.$MessengerComposerContainer14=function(t,u,v){var w=this.props.threadID,x=this.$MessengerComposerContainer2.constructUserGeneratedMessageObject(t.emoji,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),w);x.has_attachment=false;return this.$MessengerComposerContainer17(function(y){c('EmojiLikeUtils').setEmojiSize(x,u);return c('EmojiLikeUtils').setEmojiSource(x,v);});}.bind(this),this.$MessengerComposerContainer17=function(t,u){var v=this.props.threadID,w=this.props.recipients,x=false;if(!v&&w&&w.size>1){v=c('MercuryLocalIDs').generateThreadID();x=true;}if(!v)return false;var y=t(v);if(x){var z=w.map(function(aa){return c('MercuryIDs').getParticipantIDFromUserID(aa.getUniqueID());}).toArray();this.$MessengerComposerContainer5.createNewLocalThread(v,z);y.offline_threading_id=c('MercuryIDs').tokenize(v).value;y.specific_to_list=z;}if(u){u(y);}else this.$MessengerComposerContainer3.send(y,this.handleMessageSentToPendingThread);if(this.props.view===c('MessengerView').DETAIL.COMPOSE){if(c('MercuryAttachment').get(y).length>0)c('MessengerComposerActions').moveDraftToNextThread(v);c('MessengerComposerActions').exitComposeState();if(c('MercuryIDs').isLocalThread(v)){this.$MessengerComposerContainer6.subscribeOnce('messages-updated',function(aa,ba){var ca=c('MercuryThreadIDMap').get();if(ca.canLinkExternally(v))c('MessengerActions').selectThread(v);});}else c('MessengerActions').selectThread(v);}this.focusInput();return true;}.bind(this),this.handleMessageSentToPendingThread=function(){if(this.props.thread&&c('MessageRequestUtils').isMessageRequest(this.props.thread))c('MercuryThreadActions').getForFBID(this.props.viewer).movePendingToInbox(this.props.threadID);}.bind(this),this.$MessengerComposerContainer7=function(t,event){if(event.threadID===this.props.threadID)c('MercuryParticipants').get(event.participantID,function(u){if(!u||!this.refsComposer)return;var v=new (c('SearchableEntry'))({uniqueID:u.fbid,title:'@'+u.name});c('setImmediate')(function(){if(this.refsComposer){this.refsComposer.focusInput();this.refsComposer&&this.refsComposer.replyToMention&&this.refsComposer.replyToMention(v);}}.bind(this));}.bind(this));}.bind(this),p;}m.prototype.componentDidMount=function(){this.$MessengerComposerContainer1=c('MercurySendMessageHandler').getForFBID(this.props.viewer);this.$MessengerComposerContainer3=c('MercuryMessageActions').getForFBID(this.props.viewer);this.$MessengerComposerContainer5=c('MercuryThreads').getForFBID(this.props.viewer);this.$MessengerComposerContainer2=c('MercuryMessageObject').getForFBID(this.props.viewer);this.$MessengerComposerContainer6=c('MercuryThreadInformer').getForFBID(this.props.viewer);this.$MessengerComposerContainer4=new (c('SubscriptionsHandler'))();c('EmojiDispatcher').explicitlyRegisterStores([c('EmojiStateStore')]);if(c('MercuryConfig').MentionsReplyEvent)this.$MessengerComposerContainer4.addSubscriptions(c('Arbiter').subscribe(c('MercuryConfig').MentionsReplyEvent,this.$MessengerComposerContainer7));this.props.onMount&&this.props.onMount(this);};m.prototype.componentWillUnmount=function(){this.$MessengerComposerContainer4.release();};m.prototype.focusInput=function(){this.refsComposer&&this.refsComposer.focusInput&&this.refsComposer.focusInput();};m.prototype.render=function(){return c('React').createElement(c('MessengerComposer.react'),{canReply:this.props.canReply,fileUploader:this.props.fileUploader,mentionsEnabled:true,onMessageSend:this.$MessengerComposerContainer8,onPhotoUploadComplete:this.$MessengerComposerContainer9,onPhotoUploadCancel:this.$MessengerComposerContainer10,onPhotoUploadFail:this.$MessengerComposerContainer11,onPhotoUploadSubmit:this.$MessengerComposerContainer12,onResize:this.props.onResize,onStickerSelect:this.$MessengerComposerContainer13,onCustomLikeSelect:this.$MessengerComposerContainer14,onVoiceClipCreate:this.$MessengerComposerContainer15,participants:this.props.participants,recipients:this.props.recipients,ref:function(o){return this.refsComposer=o;}.bind(this),sharePreview:this.props.sharePreview,threadID:this.props.threadID,threadFBID:this.props.threadFBID,thread:this.props.thread,view:this.props.view,viewer:this.props.viewer});};m.prototype.$MessengerComposerContainer16=function(o,p){if(o)return false;return !(p&&(p.shareable_attachment||p.profile_ranges.length>0));};m.prototype.handleFileUpload=function(o){var p=o.reduce(function(q,r){var s=r.type.split('/')[0];if(q[s]){q[s].push(r);}else q.other.push(r);return q;},{audio:[],image:[],other:[]});p.audio.forEach(function(q){return this.$MessengerComposerContainer15(q);}.bind(this));if(this.refsComposer)this.refsComposer.handleFileUpload(p.image.concat(p.other));};m.prototype.handleTextDropped=function(o){if(this.refsComposer)this.refsComposer.handleTextDropped(o);};m.prototype.resetDrag=function(){if(this.refsComposer)this.refsComposer.exitCurrentMode();};m.prototype.$MessengerComposerContainer18=function(o,p){c('messengerDialogsRe').showDialog(function(){return c('React').createElement(k,{title:o,body:p});});};m.propTypes={canReply:l.bool,fileUploader:l.object,onMount:l.func,onResize:l.func,participants:l.instanceOf(c('immutable').Map),recipients:l.instanceOf(c('immutable').List),sharePreview:l.object,threadID:l.string,threadFBID:l.string,thread:l.object,view:l.string,viewer:l.string};function n(o){return {upload_id:o,preview_attachments:[{upload_id:o,attach_type:c('MercuryAttachmentType').PHOTO,preview_uploading:true}]};}f.exports=m;}),null);