if (self.CavalryLogger) { CavalryLogger.start_js(["9LPnF"]); }

__d('MessengerConversationContainer.react',['immutable','ImmutableObject','mercuryBlockedParticipantsRe','MercuryIDs','MercuryMessageStore','MessengerActions','messengerBlockedGroupThreadWarningDialogReact','MessengerConfig','MessengerConversation.react','messengerDialogsRe','MessengerHotLikePreviewEvents','MessengerLeaveGroupAction','React','SubscriptionsHandler'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('mercuryBlockedParticipantsRe').get(),k=c('React').PropTypes,l=c('messengerBlockedGroupThreadWarningDialogReact').jsComponent;h=babelHelpers.inherits(m,c('React').PureComponent);i=h&&h.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=i.constructor).call.apply(n,[this].concat(q)),this.state={isLoaded:false,isLoading:true,messages:c('immutable').List()},this.$MessengerConversationContainer2=undefined,this.$MessengerConversationContainer3=false,this.$MessengerConversationContainer4=undefined,this.$MessengerConversationContainer5=undefined,this.$MessengerConversationContainer6=undefined,this.$MessengerConversationContainer11=function(){var s=this.props.thread;if(s==null)return;c('messengerBlockedGroupThreadWarningDialogReact').setWantsToSee(s.thread_id,true);}.bind(this),this.$MessengerConversationContainer12=function(s){var t=this.props.thread;if(t==null)return;c('MessengerLeaveGroupAction').leaveGroup(t,this.props.viewer);this.$MessengerConversationContainer14(s);}.bind(this),this.$MessengerConversationContainer13=function(s){this.$MessengerConversationContainer14(s);}.bind(this),this.$MessengerConversationContainer10=function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});if(!this.$MessengerConversationContainer1.fetchMoreMessages())this.setState({isLoading:false,isLoaded:true});}.bind(this),o;}m.prototype.componentWillUnmount=function(){this.$MessengerConversationContainer2&&this.$MessengerConversationContainer2.release();clearTimeout(this.$MessengerConversationContainer6);};m.prototype.componentDidMount=function(){this.$MessengerConversationContainer7(this.props.threadID);if(this.$MessengerConversationContainer8())this.$MessengerConversationContainer9();};m.prototype.componentDidUpdate=function(n){var o=this.props.threadID!==n.threadID;if(o&&this.$MessengerConversationContainer8())this.$MessengerConversationContainer9(n.threadID);};m.prototype.componentWillReceiveProps=function(n){if(this.props.threadID!==n.threadID){this.setState({isLoading:true,messages:c('immutable').List()});this.$MessengerConversationContainer7(n.threadID);}};m.prototype.render=function(){return c('React').createElement(c('MessengerConversation.react'),{className:this.props.className,contact:this.props.contact,fetchMessages:this.$MessengerConversationContainer10,isCanonical:c('MercuryIDs').isCanonical(this.props.threadID),isLoading:this.state.isLoading,isLoaded:this.state.isLoaded,messages:this.state.messages,onRead:this.props.onMarkRead,participants:this.props.participants,ref:'conversation',thread:this.props.thread,threadID:this.props.threadID,viewer:this.props.viewer});};m.prototype.handleResize=function(){this.refs.conversation.handleResize();};m.prototype.isScrolledToBottom=function(){return !!(this.refs.conversation&&this.refs.conversation.isScrolledToBottom());};m.prototype.$MessengerConversationContainer8=function(){var n=this.props.thread;if(n==null)return false;if(c('MercuryIDs').isCanonical(this.props.threadID))return false;if(!n.is_subscribed)return false;if(!j.isPresentInGroupThread(n))return false;var o=c('messengerBlockedGroupThreadWarningDialogReact').getWantsToSee(n.thread_id);if(o)return false;return true;};m.prototype.$MessengerConversationContainer9=function(n){c('messengerDialogsRe').showDialog(function(){return c('React').createElement(l,{onSee:this.$MessengerConversationContainer11,onLeave:this.$MessengerConversationContainer12,onCancel:this.$MessengerConversationContainer13,prevThreadID:n});}.bind(this));};m.prototype.$MessengerConversationContainer14=function(n){if(n==null)c('MessengerActions').selectThread(null);c('MessengerActions').selectThread(n);};m.prototype.$MessengerConversationContainer7=function(n){if(!n)return;this.setState({isLoaded:false});this.$MessengerConversationContainer1&&this.$MessengerConversationContainer1.destroy();this.$MessengerConversationContainer1=new (c('MercuryMessageStore'))(n,c('MessengerConfig').MessageLoadCount);clearTimeout(this.$MessengerConversationContainer6);this.$MessengerConversationContainer6=setTimeout(function(){if(this.props.thread&&this.props.thread.message_count<1)this.setState({isLoaded:true,isLoading:false});}.bind(this),6000);this.$MessengerConversationContainer2&&this.$MessengerConversationContainer2.release();this.$MessengerConversationContainer2=new (c('SubscriptionsHandler'))();this.$MessengerConversationContainer2.addSubscriptions(this.$MessengerConversationContainer1.subscribe(function(o){this.setState({messages:this.$MessengerConversationContainer15(c('immutable').List(o.messages)),isLoading:false});}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').START,function(o){this.$MessengerConversationContainer3=true;this.$MessengerConversationContainer4=o;this.setState({messages:this.$MessengerConversationContainer15(this.state.messages)});clearInterval(this.$MessengerConversationContainer5);this.$MessengerConversationContainer5=setInterval(this.refs.conversation.scrollToBottom,50);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(o){clearInterval(this.$MessengerConversationContainer5);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_EMOJI_ANIMATION,function(o){clearInterval(this.$MessengerConversationContainer5);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP,function(){this.$MessengerConversationContainer3=false;this.$MessengerConversationContainer4=null;}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP_EMOJI,function(){this.$MessengerConversationContainer3=false;this.$MessengerConversationContainer4=null;}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').REMOVE,function(){clearInterval(this.$MessengerConversationContainer5);this.$MessengerConversationContainer3=false;this.setState({messages:this.$MessengerConversationContainer15(this.state.messages)});}.bind(this)));};m.prototype.$MessengerConversationContainer15=function(n){if(this.$MessengerConversationContainer3){n=n.set(n.size,this.$MessengerConversationContainer4);}else{n=n.filterNot(function(o){return o.is_like_preview;});this.$MessengerConversationContainer4=null;}return n;};m.propTypes={contact:k.instanceOf(c('ImmutableObject')),onMarkRead:k.func.isRequired,participants:k.instanceOf(c('immutable').Map),thread:k.object,threadID:k.string.isRequired,viewer:k.string.isRequired};f.exports=m;}),null);