if (self.CavalryLogger) { CavalryLogger.start_js(["hpKv3"]); }

__d('MessengerComposer.react',['cx','fbt','invariant','AsyncRequest','AutoFocusableLink.react','BootloadedComponent.react','MercuryBootloadOnInteraction.react','BootloadOnRender.react','Bootloader','ChatPhotoUploader.react','ChatConfig','CurrentUser','EmoticonsList','immutable','JSResource','LazyComponent.react','MercuryConfig','MercuryIDs','MercuryReadOnlyReason','MercuryThreadActions','MessageRequestUtils','MessagingTag','MessengerActions','MessengerBotMenuDataFetcher','messengerButtonReact','MessengerComposerInput.react','ChatPageComposerNullState.react','MessengerConstants','MessengerContextualDialog.react','messengerDialogsRe','messengerFileSizeErrorDialogReact','MessengerHotLikeButton.react','MessengerHotLikeUtils','MessengerQuickCamOrigins','MessengerResponsiveBlock.react','messengerSendButtonReact','MessengerView','MNCommercePageSetting','MNCommercePostbackCTADataManager','MNCommercePostbackRefSendManager','P2PGKValues','React','MercuryShareAttachmentRenderLocations','WorkQEWorkChatFileAttachmentIcon','XMessagingUnblockMessagesController','XMNCommercePageNullStateCTAController','getPageIDFromThreadID','isWebGLEnabled'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('messengerButtonReact').jsComponent,n=c('messengerFileSizeErrorDialogReact').jsComponent,o=c('messengerSendButtonReact').jsComponent,p=c('React').PropTypes,q=640,r=360,s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;k=babelHelpers.inherits(t,c('React').PureComponent);l=k&&k.prototype;function t(u){l.constructor.call(this,u);this.handleFileUpload=function(v){this.refsUploader&&this.refsUploader.uploadFiles(v);this.exitCurrentMode();}.bind(this);this.$MessengerComposer27=function(v){var w=c('EmoticonsList').symbols[v];if(!w)return;this.refsInput&&this.refsInput.insertEmoticon(w);}.bind(this);this.$MessengerComposer43=function(){var v=c('XMessagingUnblockMessagesController').getURIBuilder().getURI(),w=this.props.threadID;new (c('AsyncRequest'))(v).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(w)}).send();}.bind(this);this.$MessengerComposer41=function(){this.$MessengerComposer39()['delete'](this.props.threadID);c('MessengerActions').selectThread(null);}.bind(this);this.$MessengerComposer40=function(){this.$MessengerComposer39().archive(this.props.threadID);c('MessengerActions').selectThread(null);}.bind(this);this.$MessengerComposer37=function(v,w){if(v.platformFBID.toString()===c('MercuryConfig').MessengerAppID){this.props.onStickerSelect(v.resultID.toString());}else this.refsGifUploader&&this.refsGifUploader.uploadURL({attribution_app_id:v.platformFBID,external_image_url:v.source.url,preview_url:v.media.preview?v.media.preview.url:v.media.thumbnail.url,source:v.source});}.bind(this);this.$MessengerComposer38=function(v){this.focusInput();this.refsInput&&this.refsInput.insertEmoji(v);}.bind(this);this.$MessengerComposer12=function(v){this.setState({currentValue:v});}.bind(this);this.$MessengerComposer11=function(v,w,x){this.refsEmojiButton&&this.refsEmojiButton.hideFlyout();return this.props.onMessageSend&&this.props.onMessageSend(v,w,x);}.bind(this);this.$MessengerComposer36=function(v){this.refsInput&&this.refsInput.triggerSend();}.bind(this);this.$MessengerComposer9=function(){if(this.state.nullStateCTA!==null){this.setState({disableNullState:true});if(c('MNCommercePostbackRefSendManager').hasMDotMeRef(this.$MessengerComposer4())){c('MNCommercePostbackCTADataManager').sendAndConfirm(this.state.nullStateCTA.id,this.state.nullStateCTA.title,this.props.threadID,null,this.$MessengerComposer1,c('MNCommercePostbackRefSendManager').getMdotMeRef());c('MessengerActions').changeMDotMeReferral();}else c('MNCommercePostbackCTADataManager').sendAndConfirm(this.state.nullStateCTA.id,this.state.nullStateCTA.title,this.props.threadID,null,this.$MessengerComposer1);}}.bind(this);this.$MessengerComposer1=function(){this.setState({showNullState:true,disableNullState:false});}.bind(this);this.$MessengerComposer1=this.$MessengerComposer1.bind(this);this.state=this.$MessengerComposer2();}t.prototype.componentWillReceiveProps=function(u){if(u.threadID!==this.props.threadID){this.setState(this.$MessengerComposer2());if(u.thread)this.$MessengerComposer3(u.thread.message_count,c('getPageIDFromThreadID')(u.threadID));}if(u.thread&&u.thread.message_count>0)this.setState({showNullState:false});};t.prototype.componentWillMount=function(){if(this.props.thread)this.$MessengerComposer3(this.props.thread.message_count,this.$MessengerComposer4());};t.prototype.componentDidUpdate=function(u){if(u.canReply!==this.props.canReply)this.props.onResize&&this.props.onResize();if(this.props.thread){this.$MessengerComposer5();this.$MessengerComposer6();}};t.prototype.render=function(){if(!this.props.canReply){return this.$MessengerComposer7();}else if(this.props.thread&&c('MessageRequestUtils').isMessageRequest(this.props.thread)&&!this.state.pendingActionsBypassed)return this.$MessengerComposer8();var u=this.props.thread&&this.props.thread.message_count;c('MNCommercePostbackRefSendManager').sendMDotMeRef(this.$MessengerComposer4(),u);if(this.state.showNullState&&this.state.nullStateCTA!==null)return c('React').createElement(c('ChatPageComposerNullState.react'),{title:this.state.nullStateCTA.title,onClick:this.$MessengerComposer9,disabled:this.state.disableNullState});var v=this.$MessengerComposer10();return c('React').createElement(c('MessengerResponsiveBlock.react'),{breakpointsToggles:function w(x){return [x!=null&&x<=q,x];}},function(w){var x=w[0],y=w[1];return c('React').createElement('div',{'aria-label':i._("New message"),className:"_4rv3",role:'region'},c('React').createElement('div',{className:"_5irm"+(x?' '+"_1_73":'')},c('React').createElement(c('MessengerComposerInput.react'),{disableAutofocus:!!this.props.disableAutofocus,fileUploader:this.props.fileUploader,handleOnlyImageUploads:false,isComposing:v,mentionsEnabled:this.props.mentionsEnabled,ref:function(z){return this.refsInput=z;}.bind(this),onBeforeInput:function(){return this.refsEmojiButton&&this.refsEmojiButton.hideFlyout();}.bind(this),onResize:this.props.onResize,onMessageSend:this.$MessengerComposer11,participants:this.props.participants,sharePreview:this.props.sharePreview,smallerEqual640:x,thread:this.props.thread,threadID:v?c('MessengerConstants').NEW_THREAD_KEY:this.props.threadID,pageID:this.$MessengerComposer4(),viewer:this.props.viewer,onFileUpload:this.handleFileUpload,onChange:this.$MessengerComposer12,showMenu:this.state.showMenu,disableInput:this.state.disableInput}),this.$MessengerComposer13(y)));}.bind(this));};t.prototype.$MessengerComposer13=function(u){return this.state.disableInput===true?null:c('React').createElement('div',{ref:function(v){this.refsButtonsContainer=v;}.bind(this),className:"_4rv4"},this.$MessengerComposer14(u),this.$MessengerComposer15());};t.prototype.$MessengerComposer14=function(u){if(this.props.hideActions)return null;if(u&&u<r)return c('React').createElement('div',null,c('React').createElement('ul',{className:"_39bj"},this.$MessengerComposer16(),this.$MessengerComposer17(),this.$MessengerComposer18(),this.$MessengerComposer19()),c('React').createElement('ul',{className:"_39bj"},this.$MessengerComposer20(),this.$MessengerComposer21(),this.$MessengerComposer22(),this.$MessengerComposer23(),this.$MessengerComposer24()));return c('React').createElement('ul',{className:"_39bj"},c('CurrentUser').isWorkUser()&&c('WorkQEWorkChatFileAttachmentIcon').showIcon?this.$MessengerComposer25():null,this.$MessengerComposer16(),this.$MessengerComposer17(),this.$MessengerComposer18(),this.$MessengerComposer19(),this.$MessengerComposer20(),this.$MessengerComposer21(),this.$MessengerComposer22(),this.$MessengerComposer23(),this.$MessengerComposer24());};t.prototype.$MessengerComposer26=function(u){c('messengerDialogsRe').showDialog(function(){return c('React').createElement(n,{error:u.error});});};t.prototype.handleTextDropped=function(u){this.refsInput&&this.refsInput.handleTextDropped(u);};t.prototype.focusInput=function(){this.refsInput&&this.refsInput.focus();};t.prototype.$MessengerComposer21=function(){return c('React').createElement('li',null,this.$MessengerComposer28());};t.prototype.$MessengerComposer28=function(){if(!c('P2PGKValues').P2PVisible||!this.props.threadID||this.$MessengerComposer29())return null;var u="_30yy _25pc _39bk";return c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:u,ContextualDialog:c('MessengerContextualDialog.react'),threadID:this.props.threadID}),loader:c('JSResource')('P2PSendMoneyContainerBootloader.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:u,role:'button'})});};t.prototype.$MessengerComposer24=function(){if(c('ChatConfig').get('messenger_www_quickcam')&&c('ChatConfig').get('messenger_www_html5_quickcam')&&this.props.threadID)return c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:"_4rv5"+(' '+"_39bk")+(this.state.flyoutOpen?' '+"_5jhb":''),location:c('MessengerQuickCamOrigins').MESSENGER,threadID:this.props.threadID,viewer:this.props.viewer}),loader:c('JSResource')('MessengerQuickCamButtonHTML5.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:"_4rv5 _39bk",role:'button'})});return null;};t.prototype.$MessengerComposer20=function(){if(!s)return null;return c('React').createElement('li',null,c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{onVoiceClipCreate:this.props.onVoiceClipCreate}),loader:c('JSResource')('MessengerVoiceClipButton.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:"_4rv7 _39bk _30yy",role:'button'})}));};t.prototype.$MessengerComposer22=function(){if(this.props.thread&&this.props.thread.is_canonical)return null;if(!this.props.threadFBID)return null;return c('React').createElement('li',null,c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{customColor:this.props.thread&&this.props.thread.custom_color,threadFBID:this.props.threadFBID}),loader:c('JSResource')('MessengerGroupPollingButton.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:"_39bk _30yy _2o-b",role:'button'})}));};t.prototype.$MessengerComposer23=function(){var u=c('MercuryConfig').MessengerGamesGK&&c('isWebGLEnabled')();return u&&this.props.threadFBID&&!this.$MessengerComposer29()?c('React').createElement('li',null,c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{customColor:this.props.thread&&this.props.thread.custom_color,threadFBID:this.props.threadFBID}),loader:c('JSResource')('MessengerGamesButton.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:"_39bk _30yy _4ce_",role:'button'})})):null;};t.prototype.$MessengerComposer30=function(u){return c('React').createElement('li',{className:"_39bk"},c('React').createElement(c('ChatPhotoUploader.react'),{allowCrossPage:true,disabled:!(this.props.threadID||this.$MessengerComposer31()),ref:function(v){return this.refsUploader=v;}.bind(this),imageClassName:(u=='files'?"_5vn8":'')+(u=='attachment'?' '+"_46si":''),imagesOnly:false,inputClassname:"_260t",linkClassName:"_30yy _260u",onAllUploadsComplete:this.props.onPhotoUploadComplete,onLastUploadFail:this.props.onPhotoUploadFail,onLastUploadCancel:this.props.onPhotoUploadCancel,onSubmit:this.props.onPhotoUploadSubmit,onUploadError:this.$MessengerComposer26,threadID:this.props.threadID}));};t.prototype.$MessengerComposer16=function(){return this.$MessengerComposer30('files');};t.prototype.$MessengerComposer25=function(){return this.$MessengerComposer30('attachment');};t.prototype.$MessengerComposer32=function(){return this.state.currentValue.length>0||this.$MessengerComposer33()||this.$MessengerComposer34();};t.prototype.$MessengerComposer33=function(){var u=this.props.fileUploader;return Boolean(u&&u.get('uploadedFiles').size>0);};t.prototype.$MessengerComposer34=function(){var u=this.props.sharePreview;return !!(u&&u.params&&u.type);};t.prototype.$MessengerComposer35=function(){var u=this.props.fileUploader;return Boolean(u&&u.get('uploadingFiles').size>0);};t.prototype.$MessengerComposer15=function(){var u=!(this.props.threadID||this.$MessengerComposer31());if(!u&&this.$MessengerComposer32()&&!this.$MessengerComposer35())return c('React').createElement(o,{className:(this.props.threadID?"_30yy":'')+(' '+"_38lh")+(' '+"_39bl"),customColor:this.props.thread&&this.props.thread.custom_color,onClick:this.$MessengerComposer36});return c('React').createElement(c('MessengerHotLikeButton.react'),{className:"_4rv9"+(this.props.threadID?' '+"_30yy":'')+(' '+"_39bl"),disabled:u,customColor:this.props.thread&&this.props.thread.custom_color,customLike:c('MessengerHotLikeUtils').getCustomEmojiFromThread(this.props.thread)||undefined,sendSticker:this.props.onStickerSelect,sendCustomLike:this.props.onCustomLikeSelect,threadID:this.props.threadID,renderSize:24});};t.prototype.$MessengerComposer17=function(){var u=(this.props.threadID?"_30yy":'')+(' '+"_4rv6")+(' '+"_39bk");return c('React').createElement('li',null,c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:u,ContextualDialogClass:c('MessengerContextualDialog.react'),disabled:!(this.props.threadID||this.$MessengerComposer31()),getInput:function(){return this.refsInput;}.bind(this),flyoutAlignment:'right',flyoutClassName:"_293j",flyoutWidth:285,onStickerSelect:this.props.onStickerSelect,onEmoticonSelect:this.$MessengerComposer27,threadID:this.props.threadID}),loader:c('JSResource')('ChatStickerButton.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:u,role:'button'})}));};t.prototype.$MessengerComposer18=function(){var u=(this.props.threadID?"_30yy":'')+(' '+"_yht")+(' '+"_39bk");return c('React').createElement('li',null,c('React').createElement('div',{style:{display:'none'}},c('React').createElement(c('ChatPhotoUploader.react'),{allowCrossPage:true,disabled:false,ref:function(v){return this.refsGifUploader=v;}.bind(this),imagesOnly:false,onAllUploadsComplete:this.props.onPhotoUploadComplete,onLastUploadFail:this.props.onPhotoUploadFail,onLastUploadCancel:this.props.onPhotoUploadCancel,onSubmit:this.props.onPhotoUploadSubmit,onUploadError:this.$MessengerComposer26})),c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:u,ContextualDialogClass:c('MessengerContextualDialog.react'),getInput:function(){return this.refsInput;}.bind(this),getQuery:function(){return this.refsInput?this.refsInput.getValue():'';}.bind(this),location:c('MercuryShareAttachmentRenderLocations').MESSENGER,onSelect:this.$MessengerComposer37}),loader:c('JSResource')('ChatContentSearchButton.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:u,role:'button'})}));};t.prototype.$MessengerComposer19=function(){var u=(this.props.threadID?"_30yy":'')+(' '+"_5s2p")+(' '+"_39bk");return c('React').createElement('li',null,c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:u,ContextualDialogClass:c('MessengerContextualDialog.react'),flyoutAlignment:'right',getInput:function(){return this.refsInput;}.bind(this),onSelect:this.$MessengerComposer38,onMount:function(v){return this.refsEmojiButton=v;}.bind(this),sendCustomEmoji:this.props.onCustomLikeSelect,threadID:this.props.threadID}),loader:c('JSResource')('ChatEmojiButton.react').__setRef('MessengerComposer.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:u,role:'button'})}));};t.prototype.$MessengerComposer8=function(){return c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:51}}),bootloadLoader:c('JSResource')('MessengerPendingActions.react').__setRef('MessengerComposer.react'),folder:this.props.thread&&this.props.thread.folder,onAcceptClick:function(){this.$MessengerComposer39().changeFolder(this.props.threadID,c('MessagingTag').INBOX);this.setState({pendingActionsBypassed:true});}.bind(this),onDeleteClick:function(){c('Bootloader').loadModules(["messengerDeleteDialogReact"],function(u){var v=u.jsComponent;c('messengerDialogsRe').showDialog(function(){return c('React').createElement(v,{onArchive:this.$MessengerComposer40,onDelete:this.$MessengerComposer41,onToggle:this.$MessengerComposer42});}.bind(this));}.bind(this),'MessengerComposer.react');}.bind(this),onIgnoreClick:function(){this.$MessengerComposer39().changeFolder(this.props.threadID,c('MessagingTag').OTHER);c('MessengerActions').selectThread(null);}.bind(this)});};t.prototype.$MessengerComposer7=function(){if(!this.props.thread||this.props.view===c('MessengerView').DETAIL.COMPOSE)return null;var u=this.props.thread,v=this.props.participants,w=false,x=false;if(u.cannot_reply_reason==='blocked'){w=true;u.is_canonical===true||j(0);v!=null||j(0);var y=u.other_user_fbid;y!=null||j(0);var z=v.get(c('MercuryIDs').getParticipantIDFromUserID(y));z!=null||j(0);if(z.is_messenger_blocked)x=true;}if(w)if(x){return c('React').createElement('div',{className:"_4rv3"},c('React').createElement('div',{className:"_2wy4"},i._("You've blocked messages from this person. {unblock_now_button}",[i.param('unblock_now_button',c('React').createElement(m,{label:i._("Unblock now"),onClick:this.$MessengerComposer43,type:'secondary'}))])));}else return c('React').createElement('div',{className:"_4rv3"},c('React').createElement('div',{className:"_2wy4"},i._("This person isn't available at the moment.")));return c('React').createElement('div',{className:"_4rv3"},c('React').createElement('div',{className:"_2wy4"},c('MercuryReadOnlyReason').getReason(u.has_email_participant)));};t.prototype.$MessengerComposer42=function(u){if(!u)c('messengerDialogsRe').removeDialog();};t.prototype.exitCurrentMode=function(){this.refsInput&&this.refsInput.exitCurrentMode();};t.prototype.$MessengerComposer10=function(){return this.props.view===c('MessengerView').DETAIL.COMPOSE;};t.prototype.$MessengerComposer31=function(){return !!(this.$MessengerComposer10()&&this.props.recipients&&this.props.recipients.size);};t.prototype.$MessengerComposer29=function(){return !!this.$MessengerComposer4();};t.prototype.$MessengerComposer4=function(){return c('getPageIDFromThreadID')(this.props.threadID);};t.prototype.$MessengerComposer5=function(){var u=this.$MessengerComposer4();if(u){c('MessengerBotMenuDataFetcher').getHasPageSetting(u,function(v){this.setState({showMenu:v});}.bind(this),function(){this.setState({showMenu:false});}.bind(this),c('MNCommercePageSetting').STRUCTURED_MENU_ENABLED);}else this.setState({showMenu:false});};t.prototype.$MessengerComposer6=function(){var u=this.$MessengerComposer4();if(u){c('MessengerBotMenuDataFetcher').getHasPageSetting(u,function(v){this.setState({disableInput:v});}.bind(this),function(){this.setState({disableInput:false});}.bind(this),c('MNCommercePageSetting').COMPOSER_INPUT_DISABLED);}else this.setState({disableInput:false});};t.prototype.$MessengerComposer3=function(u,v){var w=u===0,x=!!v;if(x&&w){var y=c('XMNCommercePageNullStateCTAController').getURIBuilder();new (c('AsyncRequest'))().setURI(y.getURI()).setMethod('POST').setData({page_id:v}).setHandler(function(z){if(z&&z.payload){this.setState({showNullState:true,nullStateCTA:z.payload});}else this.setState({showNullState:false,disableNullState:false});}.bind(this)).send();}else this.setState({showNullState:false,disableNullState:false});};t.prototype.$MessengerComposer2=function(){return {pendingActionsBypassed:false,currentValue:'',nullStateCTA:null,showMenu:false,disableInput:false,showNullState:false,disableNullState:false};};t.prototype.$MessengerComposer39=function(){return c('MercuryThreadActions').getForFBID(this.props.viewer);};t.prototype.testUtils_renderRawP2PSendMoneyButton=function(){return this.$MessengerComposer28();};t.prototype.replyToMention=function(u){this.refsInput&&this.refsInput.addMention&&this.refsInput.addMention(u);};t.propTypes={canReply:p.bool,disableAutofocus:p.bool,fileUploader:p.object,hideActions:p.bool,mentionsEnabled:p.bool,onCustomLikeSelect:p.func,onMessageSend:p.func,onPhotoUploadComplete:p.func,onPhotoUploadCancel:p.func,onPhotoUploadFail:p.func,onPhotoUploadSubmit:p.func,onResize:p.func,onStickerSelect:p.func.isRequired,onVoiceClipCreate:p.func,participants:p.instanceOf(c('immutable').Map),recipients:p.instanceOf(c('immutable').List),sharePreview:p.object,threadID:p.string,threadFBID:p.string,thread:p.object,view:p.string,viewer:p.string};f.exports=t;}),null);